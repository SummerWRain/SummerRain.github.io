<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>æ‰©æ•£æ¨¡å‹æ€»ç»“</title>
    <link href="/2023/12/08/%E6%89%A9%E6%95%A3%E6%A8%A1%E5%9E%8B%E6%80%BB%E7%BB%93/"/>
    <url>/2023/12/08/%E6%89%A9%E6%95%A3%E6%A8%A1%E5%9E%8B%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<h1 id="æ‰©æ•£æ¨¡å‹æ€»ç»“">æ‰©æ•£æ¨¡å‹æ€»ç»“</h1><blockquote><p>æœ€è¿‘åœ¨å›é¡¾ä¹‹å‰å†™çš„Understanding DiffusionModelsæ—¶ï¼Œå‘ç°æœ‰ä¸ªé—®é¢˜ï¼Œæ–‡ç« å¤ªç»†äº†ï¼Œæ¯ä¸€æ­¥éƒ½æ˜¯æ•°å­¦æ¨å¯¼ï¼Œäºæ˜¯ï¼Œè¿™ç¯‡å¯¹å…¶è¿›è¡Œä¸€æ¬¡æ€»ç»“ï¼Œä½¿å¾—å¯¹æ¨¡å‹ç†è§£ä¸€ç›®äº†ç„¶ã€‚</p></blockquote><h2 id="å‰å‘è¿‡ç¨‹">å‰å‘è¿‡ç¨‹</h2><p><span class="math display">\[q(x_t|x_{t-1})=\mathcal N(x_t;\sqrt{\alpha_t}x_{t-1},(1-\alpha_t)I)\]</span></p><p><span class="math inline">\(x_0\sim q(x_0)\)</span>,<spanclass="math inline">\(\beta_1,...,\beta_T\)</span> is the varianceschedule, <span class="math inline">\(\alpha_t=1-\beta_t\)</span><br /><span class="math display">\[q(x_t|x_0)=\mathcal N(x_t;\sqrt{\bar\alpha_t}x_0,(1-\bar\alpha_t)I)\]</span> <spanclass="math inline">\(\bar\alpha_t=\prod_{s=1}^t\alpha_s\)</span> .</p><h2 id="åå‘è¿‡ç¨‹">åå‘è¿‡ç¨‹</h2><p><span class="math display">\[q(x_{t-1}|x_t,x_0)=\mathcal N(x_{t-1};\mu_q(x_t,x_0),\Sigma_q(t))\]</span></p><p><spanclass="math inline">\(\mu_q(x_t,x_0)=\frac{\sqrt\alpha_t(1-\bar\alpha_{t-1})x_t+\sqrt{\bar\alpha_{t-1}}(1-\alpha_t)x_0}{1-\bar\alpha_t}\)</span><span class="math display">\[p_\theta(x_{t-1}|x_t)=\mathcalN(x_{t-1};\mu_\theta(x_t,t),\Sigma_\theta(x_t,t))\]</span></p><h2 id="æŸå¤±">æŸå¤±</h2><p><span class="math display">\[L_{simple}(\theta) = \mathbbE_{t,x_0,\epsilon}[\left\|\epsilon-\epsilon_\theta(x_t,t)\right\|^2]\]</span></p><p><span class="math inline">\(x_t\sim q(x_t|x_0)\)</span></p><h2 id="é‡‡æ ·">é‡‡æ ·</h2><p>ã€‚ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Diffusion</tag>
      
      <tag>Code</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>éšæœºè¿‡ç¨‹</title>
    <link href="/2023/12/07/%E9%9A%8F%E6%9C%BA%E8%BF%87%E7%A8%8B/"/>
    <url>/2023/12/07/%E9%9A%8F%E6%9C%BA%E8%BF%87%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="éšæœºè¿‡ç¨‹">éšæœºè¿‡ç¨‹</h1><h2 id="brownè¿åŠ¨wienerè¿‡ç¨‹">Brownè¿åŠ¨ï¼ˆWienerè¿‡ç¨‹ï¼‰</h2><p>è‹¥éšæœºè¿‡ç¨‹ <span class="math inline">\(W(t)\)</span>æ»¡è¶³ä»¥ä¸‹ä¸‰æ¡æ€§è´¨ï¼š</p><ol type="1"><li><strong>è½¨çº¿è¿ç»­</strong> <span class="math inline">\(W(0)=0,W(t)æ˜¯å…³äº t çš„è¿ç»­å‡½æ•°\)</span></li><li><strong>å¢é‡æ­£æ€åˆ†å¸ƒ</strong> å¯¹äºå›ºå®š <spanclass="math inline">\(t\)</span> æœ‰ <span class="math inline">\(W(t)\sim\mathcal N(0,t)\)</span>ï¼Œä»¥åŠ <span class="math inline">\(W(t)-W(s)\sim\mathcal N(0,t-s)\)</span></li><li><strong>å¢é‡ç‹¬ç«‹</strong> <spanclass="math inline">\(W(t_n)-W(t_{n-1}),...,W(t_2)-W(t_1)\)</span> ä¸<span class="math inline">\(W(t_1)\)</span> ä¹‹é—´ç›¸äº’ç‹¬ç«‹</li></ol><p>åˆ™æˆ‘ä»¬ç§° <span class="math inline">\(W(t)\)</span>ä¸º<strong>Brownè¿åŠ¨</strong>æˆ–<strong>Wienerè¿‡ç¨‹</strong></p><h3 id="äºŒæ¬¡å˜å·®">äºŒæ¬¡å˜å·®</h3><p><span class="math inline">\(\mathbb E[W(t)]^2=t\iff\int_0^t(dW)^2=\int_0^tdt\iff (dW)^2=dt\)</span></p><blockquote><p>proof:</p><p><spanclass="math inline">\(å°†[0,t]åˆ’åˆ†æˆnä»½\to(0,\frac{t}{n},\frac{2n}{t},...,t),è®°å¢é‡\[W(\frac{k}{n}t)-W(\frac{k-1}{n}t)]=\Delta W(\frac{k}{n})\)</span></p><p>ç­‰ä»·äºè¯æ˜ <span class="math inline">\(\sum\limits_{k=1}^n[\DeltaW(\frac{k}{n})]^2\xrightarrow[n\to\infty]{m.s}t\)</span>ï¼Œå³ <spanclass="math inline">\(E[\sum\limits_{k=1}^n(\DeltaW(\frac{k}{n}))^2-t]^2\xrightarrow[n\to\infty]{m.s}0\)</span></p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204826498.png" /></p><p>å‘½é¢˜å¾—è¯</p></blockquote><h2 id="itos-formula">Itoâ€™s formula</h2><blockquote><p><span class="math display">\[dg(t,W(t))=\frac{\partial g}{\partial t}dt+\frac{\partial g}{\partialW}dW+\frac12\frac{\partial^2g}{\partial W^2}dt,\\because\ (dW)^2=dt.\]</span></p></blockquote><h3 id="ir-sdeåº”ç”¨">IR-SDEåº”ç”¨</h3><p>å‡è®¾ä¸€ä¸ª <span class="math inline">\(x\)</span> æ˜¯ä¸€ä¸ªéšæœºè¿‡ç¨‹ï¼š<span class="math display">\[dx=Fdt+Gd\omega\]</span> æƒ³è¦ä¼°è®¡ <span class="math inline">\(\psi(x,t)\)</span>,ä½¿ç”¨æ³°å‹’å±•å¼€ï¼š <span class="math display">\[\psi(x+\Delta x,t+\Delta t)\\=\psi(x,t)+\frac{\partial\psi}{\partial x}\Deltax+\frac{\partial\psi}{\partial t}\Delta t+\\\frac12\big[\frac{\partial^2\psi}{\partial x^2}\Deltax^2+\frac{\partial^2\psi}{\partial x\partial t}\Delta t\Deltax+\frac{\partial^2\psi}{\partial t^2}(\Delta t)^2\big]\]</span> å½“ <span class="math inline">\(\Delta t\to0^+\)</span> æ—¶ï¼š<span class="math display">\[d\psi(x,t)=\frac{\partial\psi}{\partialx}dx+\frac{\partial\psi}{\partialt}dt+\frac12\frac{\partial^2\psi}{\partial x^2}dx^2\\=\frac{\partial\psi}{\partial t}dt+\frac{\partial\psi}{\partialx_t}(Fdt+Gd\omega)+\frac12\frac{\partial^2\psi}{\partialx^2}(Fdt+Gd\omega)^2\\=(\frac{\partial\psi}{\partial t}+\frac{\partial\psi}{\partialx_t}F+\frac12G^2\frac{\partial^2\psi}{\partialx^2})dt+G\frac{\partial\psi}{\partial x}d\omega\]</span></p>]]></content>
    
    
    
    <tags>
      
      <tag>math</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Diffusion GAN</title>
    <link href="/2023/12/05/Diffusion%20GAN/"/>
    <url>/2023/12/05/Diffusion%20GAN/</url>
    
    <content type="html"><![CDATA[<h1id="tackling-the-generative-learning-trilemma-with-denoising-diffusion-gans">Tacklingthe Generative Learning Trilemma with Denoising Diffusion GANs</h1><h2 id="èƒŒæ™¯">èƒŒæ™¯</h2><p>ç”Ÿæˆå¼å­¦ä¹ ä¸‰å›°å¢ƒï¼šé«˜è´¨é‡é‡‡æ ·ï¼Œå¤šæ ·æ€§ï¼Œå¿«é€Ÿé‡‡æ ·</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207203928494.png" /></p><p>ä¼ ç»Ÿæ‰©æ•£æ¯ä¸€æ­¥çš„é«˜æ–¯å‡è®¾åªåœ¨å»å™ªæ­¥é•¿éå¸¸å°çš„æ—¶å€™æˆç«‹ï¼Œå› æ­¤åå‘è¿‡ç¨‹éœ€è¦å¾ˆå¤šæ­¥ï¼Œè€Œåå‘è¿‡ç¨‹ä¸­æ­¥é•¿è¾ƒå¤§ï¼ˆæ›´å°‘çš„å»å™ªæ­¥æ•°ï¼‰æ—¶ï¼Œéœ€è¦ä½¿ç”¨éé«˜æ–¯å¤šå³°åˆ†å¸ƒæ¥å»ºæ¨¡å»å™ªåˆ†å¸ƒã€‚</p><h2 id="è´¡çŒ®">è´¡çŒ®</h2><ol type="1"><li>å°†æ‰©æ•£æ¨¡å‹ç¼“æ…¢é‡‡æ ·çš„åŸå› å½’ç»“ä¸ºå»å™ªåˆ†å¸ƒçš„é«˜æ–¯å‡è®¾ï¼Œå¹¶æå‡ºä½¿ç”¨å¤æ‚ã€å¤šæ¨¡çš„å»å™ªåˆ†å¸ƒ</li><li>æå‡º Denoising Diffusion GANsï¼Œä½¿ç”¨ conditionalGANså‚æ•°åŒ–æ‰©æ•£æ¨¡å‹çš„åå‘è¿‡ç¨‹</li></ol><h2 id="æ–¹æ³•">æ–¹æ³•</h2>]]></content>
    
    
    
    <tags>
      
      <tag>Diffusion</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ELITE</title>
    <link href="/2023/11/28/ELITE/"/>
    <url>/2023/11/28/ELITE/</url>
    
    <content type="html"><![CDATA[<h1id="elite-encoding-visual-concepts-into-textual-embeddings-for-customized-text-to-image-generation">ELITE:Encoding Visual Concepts into Textual Embeddings for CustomizedText-to-Image Generation</h1><h2 id="èƒŒæ™¯">èƒŒæ™¯</h2><p>customizedæ–‡æœ¬åˆ°å›¾åƒçš„ç”Ÿæˆé—®é¢˜ï¼š<strong>ç”±äºç”¨æˆ·å¯èƒ½ä¼šä½¿ç”¨éš¾ä»¥å½¢å®¹çš„ã€ä¸ªäººçš„ä¸€äº›æ¦‚å¿µå»åˆ›é€ ä¸€äº›æœ‰æƒ³è±¡åŠ›çš„æ ·æœ¬</strong>ï¼ˆä¾‹ï¼šâ€œæŸ¯åŸºâ€ï¼‰ã€‚é€šå¸¸éœ€è¦ä»ç”¨æˆ·æä¾›çš„å°‘é‡å›¾ç‰‡é›†åˆå»å­¦ä¹ ç‰¹å®šçš„æ¦‚å¿µï¼Œç°å­˜å·¥ä½œä½¿ç”¨ä¸€ç§åŸºäºä¼˜åŒ–çš„æ–¹æ³•æ¥å­¦ä¹ customized æ¦‚å¿µï¼Œä½†æ˜¯ä¼šå¸¦æ¥è¿‡å¤šçš„è®¡ç®—å’Œå†…å­˜è´Ÿæ‹…ã€‚</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207203952840.png" /></p><p>åŸºäºGANå’ŒVAEçš„æ–¹æ³•ä¸èƒ½å¾ˆå¥½çš„åŒ¹é…ç”¨æˆ·çš„æè¿°ï¼Œå¤§æ–‡ç”Ÿå›¾æ¨¡å‹ä¹Ÿéš¾ä»¥è¡¨è¾¾ç‰¹å®šçš„æˆ–ç”¨æˆ·å®šä¹‰çš„æ¦‚å¿µã€‚</p><h2 id="è´¡çŒ®">è´¡çŒ®</h2><p>ä¸ºå¿«é€Ÿå‡†ç¡®çš„ customizedæ–‡æœ¬åˆ°å›¾åƒç”Ÿæˆæå‡ºåŸºäºå­¦ä¹ çš„ç¼–ç å™¨ELITEï¼Œç”±å…¨å±€-å±€éƒ¨æ˜ å°„ç½‘ç»œç»„æˆï¼Œç›´æ¥å°†è§†è§‰æ¦‚å¿µç¼–ç ä¸ºæ–‡æœ¬åµŒå…¥ã€‚åœ¨å°†å­¦ä¹ åˆ°çš„æ¦‚å¿µç¼–è¾‘åˆ°ä¸€ä¸ªæ–°çš„åœºæ™¯ä¸­æ—¶æœ‰è¾ƒå¥½çš„çµæ´»æ€§ï¼ŒåŒæ—¶ä¿ç•™å›¾åƒç‰¹æœ‰çš„ç»†èŠ‚ã€‚</p><p>å…¨å±€æ˜ å°„ç½‘ç»œå°†ç»™å®šå›¾åƒçš„å±‚çº§ç‰¹å¾æŠ•å°„åˆ°æ–‡æœ¬çš„ word embeddingç©ºé—´ä¸­çš„å¤šä¸ªâ€œæ–°â€çš„å•è¯ä¸­ï¼ˆä¾‹ï¼šä¸€ä¸ªä¸»è¯è¡¨ç¤ºå¯ç¼–è¾‘çš„æ¦‚å¿µï¼Œä»¥åŠå…¶ä»–è¾…åŠ©è¯æ¥æ’é™¤ä¸ç›¸å…³çš„å¹²æ‰°ï¼‰ï¼›å±€éƒ¨æ˜ å°„ç½‘ç»œå°†ç¼–ç åçš„patch ç‰¹å¾æ³¨å…¥åˆ°äº¤å‰æ³¨æ„åŠ›å±‚ä»¥æä¾›é—æ¼çš„ç»†èŠ‚ã€‚</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204007671.png" /></p><h2 id="æ–¹æ³•">æ–¹æ³•</h2><h3 id="é¢„å¤‡">é¢„å¤‡</h3><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204021828.png" /></p><p>ä½¿ç”¨ Stable diffusionä½œä¸ºæ–‡ç”Ÿå›¾æ¨¡å‹ï¼šé¦–å…ˆè®­ç»ƒä¸€ä¸ªautoencoderï¼Œencoder <spanclass="math inline">\(z=\varepsilon(x)\)</span>å°†ä¸€å¼ å›¾åƒæ˜ å°„åˆ°ä½ç»´ç©ºé—´ï¼ŒåŒæ—¶decoder <spanclass="math inline">\(D(\varepsilon(x))\approx x\)</span>å°†éšç¼–ç è¿˜åŸä¸ºä¸€å¼ å›¾åƒ;ç„¶ååœ¨éšç©ºé—´ä¸Šè®­ç»ƒæ¡ä»¶æ‰©æ•£æ¨¡å‹ <spanclass="math inline">\(\epsilon_\theta(\cdot)\)</span> ï¼ŒåŸºäºæ¡ä»¶ <spanclass="math inline">\(y\)</span> ç”Ÿæˆéšç¼–ç ã€‚ä½¿ç”¨å‡æ–¹è¯¯å·®æ¥è®­ç»ƒï¼š <spanclass="math display">\[L_{LDM}=\mathbb E_{z\sim\varepsilon(x),y,\epsilon\sim\mathcalN(0,1),t}\big[\left\|\epsilon-\epsilon_\theta(z_t,t,\tau_\theta(y))\right\|_2^2\big]\]</span> <span class="math inline">\(\tau_\theta(\cdot)\)</span>è¡¨ç¤ºCLIP text-encoderã€‚æ¨ç†æ—¶ï¼Œé«˜æ–¯å™ªå£° <spanclass="math inline">\(z_T\)</span> é€æ¸å»å™ªä¸º <spanclass="math inline">\(z_0\)</span> ,ç„¶åæœ€ç»ˆçš„å›¾åƒé€šè¿‡decoderå¾—åˆ° <spanclass="math inline">\(x&#39;=\mathcal D(z_0)\)</span></p><p><strong>äº¤å‰æ³¨æ„åŠ›</strong> ä¸ºäº†åœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­åˆ©ç”¨æ–‡æœ¬ä¿¡æ¯</p><blockquote><p><span class="math display">\[Attention(Q,K,V)=Softmax(\frac{QK^T}{\sqrt{d&#39;}})V\]</span></p><p><span class="math inline">\(Q=W_Q\cdot f,K=W_K\cdot\tau_\theta(y),V=W_V\cdot\tau_\theta(y)\)</span> ï¼Œ<spanclass="math inline">\(f\)</span> ä¸ºéšå›¾åƒç‰¹å¾ï¼Œ<spanclass="math inline">\(\tau_\theta(y)\)</span> ä¸ºæ–‡æœ¬ç‰¹å¾ï¼Œ<spanclass="math inline">\(d&#39;\)</span>ä¸ºkeyå’Œqueryçš„è¾“å‡ºç»´åº¦ï¼Œéšå›¾åƒç‰¹å¾é€šè¿‡æ³¨æ„åŠ›å—æ›´æ–°ã€‚</p></blockquote><hr /><h3 id="å…¨å±€æ˜ å°„ç½‘ç»œ"><strong>å…¨å±€æ˜ å°„ç½‘ç»œ</strong></h3><p>ä½¿ç”¨CLIPå›¾åƒç¼–ç å™¨ <spanclass="math inline">\(\psi_\theta(\cdot)\)</span>ä½œä¸ºç‰¹å¾æå–å™¨ï¼Œå…¨å±€æ˜ å°„ç½‘ç»œ <spanclass="math inline">\(M^g(\cdot)\)</span>ç‰¹å¾æŠ•å½±åˆ°CLIPæ–‡æœ¬ç¼–ç å™¨çš„æ–‡æœ¬è¯åµŒå…¥<span class="math inline">\(v\)</span> : <span class="math display">\[v=M^g\circ\psi_\theta(x)\]</span> <span class="math inline">\(v\in \mathbb R^{N\timesd}\)</span>ï¼Œ<span class="math inline">\(N\)</span> ä¸ºå•è¯æ•°ï¼Œ<spanclass="math inline">\(d\)</span>ä¸ºè¯å‘é‡çš„ç»´åº¦ï¼Œå¯¹ç‰¹å¾ä½¿ç”¨å…¨å±€å¹³å‡æ± åŒ–æ¥è·å¾—è¯åµŒå…¥ã€‚ç”±äºä¸€å¼ å›¾åƒä¼šæœ‰ä¸»ä½“å’Œå…¶ä»–ä¸ç›¸å…³å…ƒç´ ï¼Œç¼–ç ä¸ºå•ä¸ªå•è¯ä¼šæŸå¤±ä¸»ä½“çš„å¯ç¼–è¾‘æ€§ï¼Œäºæ˜¯åˆ†åˆ«å­¦ä¹ ä¸»è¯å’Œè¾…åŠ©è¯ï¼šä»CLIPæœ€æ·±å±‚ç‰¹å¾å­¦åˆ°ä¸»è¦æ¦‚å¿µï¼ˆä¸»ä½“ï¼‰ï¼Œä»å…¶ä»–å±‚å­¦åˆ°çš„è¾…åŠ©è¯æè¿°å…¶ä»–ä¸ç›¸å…³å…ƒç´ ã€‚ä»CLIPå›¾åƒç¼–ç å™¨ä¸­é€‰æ‹©<span class="math inline">\(N\)</span> å±‚ï¼Œæ¯ä¸€å±‚ <spanclass="math inline">\(\psi_\theta^{L_i}(\cdot)\)</span>ç‹¬ç«‹çš„å­¦ä¹ ä¸€ä¸ªå•è¯ <span class="math inline">\(w_i\)</span></p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204032657.png" /></p><p>è®­ç»ƒç›®æ ‡ï¼š <span class="math display">\[L_{global}=L_{LDM}+\lambda_{global}\left\|v\right\|_1\]</span> è®­ç»ƒæ—¶éšæœºä»CLIP ImageNettemplatesé‡‡æ ·ä¸€ä¸ªæ–‡æœ¬ä½œä¸ºæ–‡æœ¬è¾“å…¥ï¼Œkey å’Œ value åˆ†åˆ«é€šè¿‡ <spanclass="math inline">\(M^g(\cdot)\)</span> å¾®è°ƒã€‚<spanclass="math inline">\(K^g=W_K^g\cdot\tau_\theta(y),V^g=W_V^g\cdot\tau_\theta(y)\)</span></p><hr /><h3 id="å±€éƒ¨æ˜ å°„ç½‘ç»œ"><strong>å±€éƒ¨æ˜ å°„ç½‘ç»œ</strong></h3><p>å±€éƒ¨æ˜ å°„ç½‘ç»œ <span class="math inline">\(M^l(\cdot)\)</span>å°†å¤šå±‚CLIPç‰¹å¾ç¼–ç åˆ°æ–‡æœ¬ç‰¹å¾ç©ºé—´ä¸­ï¼ˆæ–‡æœ¬ç¼–ç å™¨çš„è¾“å‡ºç©ºé—´ï¼‰ã€‚ <spanclass="math display">\[e=M^l\circ\psi_\theta(x*m)\]</span> <span class="math inline">\(m\)</span>æ˜¯å¯¹è±¡çš„maskï¼Œç”¨æ¥å›é¿èƒŒæ™¯ä¸­ä¸éœ€è¦çš„ç»†èŠ‚ï¼Œ<spanclass="math inline">\(e\in\mathbb R^{p\times p\times d}\)</span>ä¿æŒç©ºé—´ç»“æ„ï¼Œ<span class="math inline">\(p\)</span> ä¸ºç‰¹å¾çš„sizeã€‚<spanclass="math inline">\(e\)</span>çš„æ¯ä¸ªåƒç´ ä¸»è¦é›†ä¸­äºç»™å®šå›¾åƒçš„æ¯ä¸ªpatchçš„å±€éƒ¨ç»†èŠ‚ï¼Œç„¶åå°†å¾—åˆ°çš„æ–‡æœ¬åµŒå…¥æ³¨å…¥åˆ°äº¤å‰æ³¨æ„åŠ›å±‚<spanclass="math inline">\(Attention(Q,K^l,V^l),K^l=W_K^l\cdot(e*m),V^l=W_V^l\cdot(e*m)\)</span>ï¼Œä¸å…¨å±€éƒ¨åˆ†èåˆä»¥æ”¹è¿›å±€éƒ¨ç»†èŠ‚:<span class="math display">\[Out=Attention(Q,K^g,V^g)+\lambda Attention(Q,K^l,V^l)\]</span> ä¸ºäº†å¼ºè°ƒç›®æ ‡åŒºåŸŸï¼Œå°†å¾—åˆ°çš„æ³¨æ„åŠ›å›¾ <spanclass="math inline">\(Q{K^l}^T\)</span> é€šè¿‡ <spanclass="math inline">\(Q{K^g}^T\)</span> é‡æ–°åŠ æƒã€‚</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204040735.png" /></p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204047752.png" /></p><p>è®­ç»ƒç›®æ ‡ï¼š <span class="math display">\[L_{local}=L_{LDM}+\lambda_{local}\left\|V^l\right\|_1\]</span></p><hr /><h2 id="å®éªŒ">å®éªŒ</h2><p>ä½¿ç”¨OpenImageçš„æµ‹è¯•é›†è¿›è¡Œè®­ç»ƒï¼Œä¸»ä½“maské€šè¿‡é¢„è®­ç»ƒçš„åˆ†å‰²æ¨¡å‹å¾—åˆ°ã€‚æ˜ å°„ç½‘ç»œä½¿ç”¨3å±‚MLPï¼Œé€‰æ‹©{24ï¼Œ4ï¼Œ8ï¼Œ12ï¼Œ16}å±‚çš„CLIPç‰¹å¾ï¼Œé‡‡æ ·å™¨ä½¿ç”¨LMSé‡‡æ ·å™¨ã€‚</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204055309.png" /></p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204103826.png" /></p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204110051.png" /></p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204126287.png" /></p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204133882.png" /></p><h2 id="å±€é™">å±€é™</h2><p>ä¸èƒ½å¤„ç†æ¶‰åŠæ–‡æœ¬å­—ç¬¦çš„å›¾ç‰‡ï¼š</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204146549.png" /></p>]]></content>
    
    
    
    <tags>
      
      <tag>Diffusion</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Understanding Diï¬€usion Models</title>
    <link href="/2023/11/13/Understanding%20diffusion/"/>
    <url>/2023/11/13/Understanding%20diffusion/</url>
    
    <content type="html"><![CDATA[<h1id="understanding-diï¬€usion-models-a-uniï¬ed-perspective">UnderstandingDiï¬€usion Models: A Uniï¬ed Perspective</h1><h2 id="elbo">ELBO</h2><p>ç›®æ ‡ï¼šå­¦ä¹ ä¸€ä¸ªæ¨¡å‹å»æœ€å¤§åŒ– <span class="math inline">\(p(x)\)</span>çš„ä¼¼ç„¶</p><p>æ³•ä¸€ï¼š<span class="math inline">\(p(x)=\int p(x,z)dz\)</span></p><p>æ³•äºŒï¼š<spanclass="math inline">\(p(x)=\frac{p(x,z)}{p(z|x)}\)</span></p><p>ä»£ç†ç›®æ ‡ï¼š<strong>æœ€å¤§åŒ–ELBO</strong></p><p><span class="math display">\[\log{p(x)} \ge \mathbbE_{q_\phi(z|x)}\Big[\log{\frac{p(x,z)}{q_\phi(z|x)}}\Big]\]</span></p><p>whyï¼Ÿ</p><p>ä½¿ç”¨æ³•ä¸€è¯æ˜ï¼š</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204336825.png" /></p><p>å¹¶ä¸èƒ½å‘Šè¯‰æˆ‘ä»¬å¤ªå¤šå¹•åå®é™…æƒ…å†µçš„æœ‰ç”¨ä¿¡æ¯ï¼Œè€Œä¸”è¿™ä¸ªè¯æ˜å¹¶æ²¡æœ‰ç›´è§‚çš„ç»™å‡ºç©¶ç«Ÿä¸ºä»€ä¹ˆELBOå®é™…ä¸Šæ˜¯è¯æ®çš„ä¸‹é™</p><p>äºæ˜¯ä½¿ç”¨æ³•äºŒè¯æ˜ï¼š</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204345263.png" /></p><p>å› æ­¤è¯æ®å°±ç­‰äºELBOåŠ ä¸ŠKLæ•£åº¦</p><p><span class="math inline">\(\log{p(x)}\)</span> å¯¹äº <spanclass="math inline">\(\phi\)</span> æ€»æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œå› æ­¤ï¼Œ<spanstyle="background-color: #ff666680">æœ€å¤§åŒ–ELBOé¡¹å°±ç›¸å½“äºæœ€å°åŒ–KLæ•£åº¦é¡¹</span></p><h2 id="vae">VAE</h2><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204353735.png" /></p><p>è¾“å…¥æ•°æ®ç»è¿‡ä¸­é—´çš„bottleneckè¡¨ç¤ºæ­¥éª¤åè¢«è®­ç»ƒæ¥é¢„æµ‹å®ƒæœ¬èº«</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204400769.png" /></p><p><strong>encoder</strong>ï¼šå­¦ä¹ ä¸­é—´çš„bottleneckåˆ†å¸ƒ <spanclass="math inline">\(q_\phi(z|x)\)</span>å°†è¾“å…¥è½¬æ¢ä¸ºå¯èƒ½çš„æ½œåœ¨åˆ†å¸ƒ</p><p><strong>decoder</strong>: å­¦ä¹ ç¡®å®šçš„å‡½æ•° <spanclass="math inline">\(p_\theta(x|z)\)</span> å°†è¾“å…¥çš„æ½œåœ¨å‘é‡ <spanclass="math inline">\(z\)</span> è½¬æ¢ä¸ºè§‚æµ‹ <spanclass="math inline">\(x\)</span></p><p>ç¬¬ä¸€é¡¹è¡¡é‡å˜åˆ†åˆ†å¸ƒçš„decoderçš„é‡å»ºä¼¼ç„¶ï¼Œä¿è¯å­¦åˆ°çš„åˆ†å¸ƒå¯ä»¥å»ºæ¨¡æœ‰æ•ˆçš„å¯ä»¥é‡æ–°ç”ŸæˆåŸå§‹æ•°æ®çš„æ½œåœ¨å˜é‡ï¼›ç¬¬äºŒé¡¹è¡¡é‡å­¦ä¹ åˆ°çš„å˜åˆ†åˆ†å¸ƒå’Œæ½œåœ¨å˜é‡çš„å…ˆéªŒä¿¡å¿µæœ‰å¤šç›¸ä¼¼ï¼Œæœ€å°åŒ–è¯¥é¡¹å¯ä»¥é¿å…å­¦åˆ°çš„åˆ†å¸ƒåå¡Œä¸ºDiracdeltaå‡½æ•°</p><p><u>é‚£ä¹ˆæœ€å¤§åŒ–ELBOç­‰ä»·äºæœ€å¤§åŒ–ç¬¬ä¸€é¡¹ã€æœ€å°åŒ–ç¬¬äºŒé¡¹</u></p><p>VAEçš„encoderé€šå¸¸é€šè¿‡å¯¹æ•°åæ–¹å·®å»ºæ¨¡ä¸€ä¸ªå¤šå…ƒé«˜æ–¯ï¼Œå…ˆéªŒå™¨é€šå¸¸è¢«é€‰æ‹©ä¸ºä¸€ä¸ªæ ‡å‡†é«˜æ–¯ï¼š</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204408488.png" /></p><p>KLæ•£åº¦é¡¹åœ¨åˆ†æä¸Šå¯ä»¥è¢«è®¡ç®—ï¼Œé‡å»ºé¡¹å¯ä»¥ä½¿ç”¨è’™ç‰¹å¡ç½—æ–¹æ³•è¿‘ä¼¼ï¼Œäºæ˜¯ç›®æ ‡å˜ä¸ºï¼š</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204416402.png" /></p><p>ç”±äºæ¯ä¸ª <span class="math inline">\(z\)</span>è¢«éšæœºé‡‡æ ·ï¼Œé€šå¸¸ä¸å¯å¾®ï¼Œå› æ­¤é€šè¿‡é‡æ–°å‚æ•°åŒ–æŠ€å·§è§£å†³ï¼šé‡å†™éšæœºå˜é‡ä¸ºä¸€ä¸ªç¡®å®šçš„å™ªå£°å˜é‡çš„å‡½æ•°ã€‚äºæ˜¯æ¯ä¸ª<span class="math inline">\(z\)</span> å¯ä»¥è¢«è¾“å…¥ä¸º <spanclass="math inline">\(x\)</span> çš„ç¡®å®šå‡½æ•°ä»¥åŠè¾…åŠ©å™ªå£°å˜é‡ <spanclass="math inline">\(\epsilon\)</span> æ‰€è®¡ç®—ï¼š</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204423652.png" /></p><p>è®­ç»ƒVAEåï¼Œå¯ä»¥ç›´æ¥ä»éšç©ºé—´ <span class="math inline">\(p(z)\)</span>é‡‡æ ·ï¼Œç„¶åé€šè¿‡decoderç”Ÿæˆæ–°æ•°æ®ã€‚å½“ <spanclass="math inline">\(z\)</span> çš„ç»´åº¦å°äº <spanclass="math inline">\(x\)</span>æ—¶ï¼Œæˆ–è®¸å¯ä»¥å­¦ä¹ åˆ°é‡è¦ã€æœ‰è¶£çš„è¡¨ç¤ºï¼Œæ­¤å¤–ï¼Œå½“è¯­ä¹‰ä¸Šæœ‰æ„ä¹‰çš„éšç©ºé—´è¢«å­¦ä¹ ï¼Œéšå‘é‡å¯ä»¥åœ¨é€šè¿‡decoderä¹‹å‰è¢«ç¼–è¾‘æ¥æ§åˆ¶æ•°æ®çš„ç”Ÿæˆ</p><h2 id="hierarchical-variational-autoencoders">Hierarchical VariationalAutoencoders</h2><p>ä¸€èˆ¬çš„HVAEæœ‰Tä¸ªå±‚çº§ï¼Œæ¯ä¸ªéšå˜é‡éƒ½å¯ä»¥ä»¥å‰é¢çš„éšå˜é‡ä¸ºæ¡ä»¶</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204430964.png" /></p><p>decodingæ¯ä¸ª <span class="math inline">\(z_t\)</span> éƒ½åªä»¥å‰é¢çš„<span class="math inline">\(z_{t+1}\)</span>ä¸ºæ¡ä»¶ï¼ˆå¯ä»¥ç†è§£ä¸ºé€’å½’å¼çš„VAEï¼‰ï¼Œè”åˆåˆ†å¸ƒå’ŒåéªŒå™¨å®šä¹‰ä¸ºï¼š</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204438090.png" /></p><p>æ‰©å±•ELBOä¸ºï¼š</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204445749.png" /></p><p>ä»£å…¥è”åˆåˆ†å¸ƒã€åéªŒå™¨ï¼š</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204453280.png" /></p><p>å˜åˆ†æ‰©æ•£æ¨¡å‹å¯ä»¥æ›´è¿›ä¸€æ­¥å°†è¿™ä¸ªç›®æ ‡åˆ†è§£ä¸ºå¯è§£é‡Šçš„ç»„åˆ†</p><h2 id="variational-diffusion-models">Variational Diffusion Models</h2><p>ä¸‰ä¸ªå…³é”®çº¦æŸï¼š</p><ul><li><p>éšå˜é‡ç»´åº¦ä¸æ•°æ®ç»´åº¦ç›¸åŒ</p></li><li><p>æ¯ä¸€æ­¥çš„éšå˜é‡ç¼–ç å™¨ä¸ºä¸€ä¸ªé¢„å®šä¹‰çš„çº¿æ€§é«˜æ–¯æ¨¡å‹ï¼Œä¸éœ€è¦å­¦ä¹ </p></li><li><p>æœ€åçš„æ—¶é—´æ­¥Tæ—¶åˆ»éšå˜é‡ä¸ºä¸€ä¸ªæ ‡å‡†é«˜æ–¯</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204500602.png" /></p></li></ul><p>æ”¹å†™åéªŒå™¨ï¼š</p><p><span class="math display">\[q(x_{1:T}|x_0)=\prod_{t=1}^{T}q(x_t|x_{t-1})\tag {30}\]</span></p><p>encoderè½¬ç§»ï¼š</p><p><span class="math display">\[q(x_t|x_{t-1})=\mathcal N(x_t;\sqrt{\alpha_t}x_{t-1},(1-\alpha_t)\mathbfI)\tag{31}\]</span></p><p>æ”¹å†™HVAEçš„è”åˆåˆ†å¸ƒï¼š</p><p><span class="math display">\[p(x_{0:T})=p(x_T)\prod_{t=1}^Tp_\theta(x_{t-1|x_t})\tag{32}\]</span></p><p><span class="math display">\[p(x_T)=\mathcal N(x_T;0,\mathbf I)\tag{33}\]</span></p><blockquote><p>é€æ¸åœ°æ·»åŠ å™ªå£°ç ´åå›¾åƒï¼Œç›´è‡³å…¶æœ€ç»ˆä¸çº¯é«˜æ–¯å™ªå£°å®Œå…¨ç›¸åŒ</p></blockquote><p>VDMçš„é‡‡æ ·è¿‡ç¨‹å˜ä¸ºï¼šä»<span class="math inline">\(p(x_T)\)</span>é‡‡æ ·ä¸€ä¸ªé«˜æ–¯å™ªå£°ï¼Œç„¶åé€æ¸è¿è¡Œå»å™ªè½¬ç§» <spanclass="math inline">\(p_\theta(x_{t-1}|x_t)\)</span> ç”Ÿæˆæ–°çš„ <spanclass="math inline">\(x_0\)</span>ã€‚é€šè¿‡æœ€å¤§åŒ–ELBOæ¥ä¼˜åŒ–VDMï¼š</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204510858.png" /></p><blockquote><p><strong>é‡å»ºé¡¹</strong>é¢„æµ‹ç»™å®šç¬¬ä¸€æ­¥éšå˜é‡ååŸå§‹æ•°æ®çš„å¯¹æ•°ä¼¼ç„¶ï¼›<strong>å…ˆéªŒåŒ¹é…é¡¹</strong>ä¸éœ€è¦è¢«ä¼˜åŒ–ï¼Œå‡è®¾ä¸€ä¸ªè¶³å¤Ÿå¤§çš„Tï¼Œæœ€åçš„åˆ†å¸ƒä¸ºé«˜æ–¯åˆ†å¸ƒï¼Œè¿™é¡¹å®é™…ä¸Šä¸º0ï¼›<strong>ä¸€è‡´é¡¹</strong>ä½¿å¾—ä¸€å¼ å™ªå£°å›¾çš„å»å™ªæ­¥åº”è¯¥åŒ¹é…ä¸€å¼ å¹²å‡€å›¾çš„åŠ å™ªæ­¥ï¼š</p></blockquote><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204518184.png" /></p><p>ä¸Šé¢çš„ç»“æœæ˜¯å¯èƒ½æ˜¯æ¬¡ä¼˜è§£ï¼Œç”±äºä¸€è‡´é¡¹ä½œä¸ºä¸€ä¸ªæœŸæœ›åœ¨æ¯ä¸ªæ—¶é—´æ­¥æœ‰ä¸¤ä¸ªéšæœºå˜é‡ï¼Œä½¿ç”¨è’™ç‰¹å¡æ´›ä¼°è®¡å¯èƒ½ä¼šæœ‰è¾ƒé«˜çš„æ–¹å·®ã€‚æ”¹è¿›æ–¹æ¡ˆï¼š<spanstyle="background-color: #ff666680">å°†encoderè½¬ç§»æ”¹å†™ä¸º <spanclass="math"><spanclass="math inline">\(q(x_t|x_{t-1})=q(x_t|x_{t-1},x_0)\)</span></span>ï¼Œ</span>æ ¹æ®è´å¶æ–¯è§„åˆ™ç»§ç»­æ”¹å†™ï¼š</p><p><span class="math display">\[q(x_t|x_{t-1},x_0)=\frac{q(x_{t-1}|x_t,x_0)q(x_t|x_0)}{q(x_{t-1}|x_0)}\tag{46}\]</span></p><p>é‡æ–°è¿›è¡Œæ¨å¯¼ELBOï¼š</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204525454.png" /></p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204532467.png" /></p><blockquote><p><strong>é‡å»ºé¡¹</strong>ä¸æ™®é€šçš„VAEç›¸ä¼¼ï¼Œå¯ä»¥ä½¿ç”¨è’™ç‰¹å¡æ´›ä¼°è®¡æ¥è¿‘ä¼¼ï¼›<strong>å…ˆéªŒåŒ¹é…é¡¹</strong>è¡¨ç¤ºæœ€ç»ˆçš„å™ªå£°åˆ†å¸ƒä¸æ ‡å‡†é«˜æ–¯å…ˆéªŒåˆ†å¸ƒæœ‰å¤šæ¥è¿‘ï¼ŒåŒæ ·çš„ä¸éœ€è¦è®­ç»ƒï¼Œæ ¹æ®å‡è®¾åŒæ ·è¶‹äº0ï¼›<strong>å»å™ªåŒ¹é…é¡¹</strong>ä¸­çš„<span class="math inline">\(q(x_{t-1}|x_t,x_0)\)</span>è½¬ç§»æ­¥å¯ä»¥çœ‹ä½œground-truthä¿¡å·ï¼Œå®šä¹‰äº†æœ‰å™ªå£°çš„å›¾åƒ <spanclass="math inline">\(x_t\)</span>åº”è¯¥å¦‚ä½•å»å™ªï¼Œå¹¶è·å¾—æœ€åçš„å®Œå…¨å»å™ªçš„å›¾åƒ <spanclass="math inline">\(x_0\)</span> Â åº”è¯¥æ˜¯ä»€ä¹ˆ</p></blockquote><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204539891.png" /></p><p><strong>å»å™ªåŒ¹é…é¡¹</strong>ä¸­çš„KLæ•£åº¦éš¾ä»¥è®¡ç®—ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨é«˜æ–¯è½¬ç§»çš„å‡è®¾è¿›è¡Œä¼˜åŒ–ï¼Œæ ¹æ®è´å¶æ–¯è§„åˆ™ï¼š</p><p><span class="math display">\[q(x_{t-1}|x_t,x_0)=\frac{q(x_t|x_{t-1},x_0)q(x_{t-1}|x_0)}{q(x_t|x_0)}\]</span></p><p><span class="math inline">\(q(x_t|x_{t-1})=q(x_t|x_{t-1})=\mathcalN(x_t;\sqrt{\alpha_t}x_{t-1},(1-\alpha_t)\mathbf I)\)</span>ï¼Œæ ¹æ®é‡æ–°å‚æ•°åŒ–æŠ€å·§ï¼Œé‡å†™é‡‡æ · <span class="math inline">\(x_t\simq(x_t|x_{t-1})\)</span> :</p><p><span class="math display">\[x_t=\sqrt \alpha_tx_{t-1}+\sqrt{1-\alpha_t}\epsilon\tag{59}\]</span></p><p><span class="math display">\[x_{t-1}=\sqrt \alpha_{t-1}x_{t-2}+\sqrt{1-\alpha_{t-1}}\epsilon\tag{60}\]</span></p><p>äºæ˜¯ï¼š</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204547855.png" /></p><p>ä»£å…¥å¾—ï¼š</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204554664.png" /></p><p>å°†æ–¹å·®é‡å†™ï¼Œ<spanclass="math inline">\(\Sigma_q(t)=\sigma_q^2(t)\mathbf I\)</span>,åˆ™ï¼š</p><p><span class="math display">\[\sigma_q^2(t)=\frac{(1-\alpha_t)(1-\bar\alpha_{t-1})}{1-\bar\alpha_t}\tag{85}\]</span></p><p>ä¸ºäº†åŒ¹é…è¿‘ä¼¼ground-truthå»å™ªè½¬ç§»æ­¥<span style="color: #eb52f7"> <spanclass="math"><spanclass="math inline">\(q(x_{t-1}|x_t,x_0)\)</span></span></span>ï¼Œå°†è¿‘ä¼¼<span style="color: #4eb31c"> <span class="math"><spanclass="math inline">\(p_\theta(x_{t-1}|x_{t})\)</span></span></span>ä¹Ÿå»ºæ¨¡ä¸ºé«˜æ–¯åˆ†å¸ƒã€‚ç”±äº <spanclass="math inline">\(\alpha\)</span>é¡¹å·²çŸ¥ï¼Œäºæ˜¯è¿‘ä¼¼çš„æ–¹å·®å°±å¯ä»¥æ˜¯<span style="color: #eb52f7"> <spanclass="math"><spanclass="math inline">\(\Sigma_q(t)=\sigma_q^2(t)\mathbf I\)</span></span></span>.å› æ­¤å¿…é¡»å‚æ•°åŒ–å®ƒçš„å‡å€¼<span style="color: #4eb31c"> <spanclass="math"><spanclass="math inline">\(\mu_\theta(x_t,t)\)</span></span> </span>.</p><p>ä¸¤ä¸ªé«˜æ–¯åˆ†å¸ƒä¹‹é—´çš„KLæ•£åº¦ï¼š</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204601419.png" /></p><p><span class="math display">\[D_{KL}(\mathcal N(x;\mu_x,\Sigma_x)\parallel\mathcalN(y;\mu_y,\Sigma_y))=\frac{1}{2}\bigg[\log\frac{|\Sigma_y|}{|\Sigma_x|}-d+tr(\Sigma_y^{-1}\Sigma_x)+(\mu_y-\mu_x)^T\Sigma_y^{-1}(\mu_y-\mu_x)\bigg]\tag{86}\]</span></p><p>é‚£ä¹ˆ<strong>å»å™ªåŒ¹é…é¡¹</strong>ä¸­çš„KLæ•£åº¦å¯ä»¥é€šè¿‡æœ€å°åŒ–è¿™ä¸¤ä¸ªåˆ†å¸ƒçš„<spanstyle="background-color: #ff666680">å‡å€¼</span>å·®å¼‚æ¥å‡å°ï¼š</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204609882.png" /></p><p><span class="math display">\[\mu_q(x_t,x_0)=\frac{\sqrt\alpha_t(1-\bar\alpha_{t-1})x_t+\sqrt{\bar\alpha_{t-1}}(1-\alpha_t)x_0}{1-\bar\alpha_t}\tag{93}\]</span></p><p><span class="math display">\[\mu_\theta(x_t,t)=\frac{\sqrt\alpha_t(1-\bar\alpha_{t-1})x_t+\sqrt{\bar\alpha_{t-1}}(1-\alpha_t)\hatx_\theta(x_t,t)}{1-\bar\alpha_t}\tag{94}\]</span></p><p>å› æ­¤ä¼˜åŒ–é—®é¢˜ç®€åŒ–ä¸ºï¼š</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204624272.png" /></p><p>å› æ­¤ä¼˜åŒ–VDMå½’ç»“èµ·æ¥å°±æ˜¯å­¦ä¹ ä¸€ä¸ªNNä»ä»»æ„å™ªå£°ç‰ˆæœ¬çš„å›¾åƒä¸­é¢„æµ‹å‡ºåŸå§‹å›¾åƒã€‚æ­¤å¤–ï¼Œæœ€å°åŒ–æ‰€æœ‰å™ªå£°æ°´å¹³ä¸Šå…¬å¼<spanclass="math inline">\((58)\)</span>ä¸­çš„æ±‚å’Œé¡¹å¯ä»¥é€šè¿‡æœ€å°åŒ–æ‰€æœ‰æ—¶é—´æ­¥çš„æœŸæœ›æ¥è¿‘ä¼¼ï¼š</p><p><span class="math display">\[\underset{\theta}{arg\ min}\ \mathbb E_{t\sim U{2,T}}\big[\mathbbE_{q(x_t|x_0)}[D_{KL}(q(x_{t-1}|x_t,x_0)\parallelp_\theta(x_{t-1}|x_t))]\big]\tag{100}\]</span></p><p>å¯ä»¥åœ¨æ¯ä¸ªæ—¶é—´æ­¥ä½¿ç”¨éšæœºé‡‡æ ·æ¥ä¼˜åŒ–ã€‚</p><h2 id="å­¦ä¹ å™ªå£°å‚æ•°">å­¦ä¹ å™ªå£°å‚æ•°</h2><p>å¦‚ä½•å­¦ä¹ å™ªå£°å‚æ•°ï¼Ÿä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ä¸€ä¸ªNN <spanclass="math inline">\(\hat\alpha_\eta(t)\)</span> æ¥å»ºæ¨¡ <spanclass="math inline">\(\alpha_t\)</span> ï¼Œä½†æ˜¯å¾ˆä½æ•ˆã€‚è§£å†³æ–¹æ¡ˆï¼š</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204631290.png" /></p><p>ç”±äº <span class="math inline">\(q(x_t|x_0)\sim \mathcalN(x_t;\sqrt{\bar\alpha_t}x_0,(1-\bar\alpha_t)\mathbf I)\)</span>,æ ¹æ®ä¿¡å™ªæ¯”å®šä¹‰ <spanclass="math inline">\(\mathrm{SNR}=\frac{\mu^2}{\sigma^2}\)</span>,ï¼Œæ¯ä¸ªæ—¶é—´æ­¥çš„SNRä¸ºï¼š</p><p><span class="math display">\[\mathrm{SNR}(t)=\frac{\bar\alpha_t}{1-\bar\alpha_t}\tag{109}\]</span></p><p><span class="math display">\[\frac{1}{2\sigma_q^2(t)}\frac{\bar\alpha_{t-1}(1-\alpha_t)^2}{(1-\bar\alpha_t)^2}\Big[\left\|\hatx_\theta(x_t,t)-x_0\right\|_2^2\Big]=\frac{1}{2}(\mathrm{SNR}(t-1)-\mathrm{SNR}(t))\Big[\left\|\hatx_\theta(x_t,t)-x_0\right\|_2^2\Big]\tag{110}\]</span></p><p>SNRè¡¨ç¤ºåŸå§‹ä¿¡å·ä¸å™ªå£°ä¹‹é—´çš„æ¯”å€¼ï¼Œåœ¨æ‰©æ•£ä¸­æˆ‘ä»¬éœ€è¦SNRéšç€tçš„å¢åŠ è€Œå‡å°ï¼Œäºæ˜¯å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p><p><span class="math display">\[\mathrm{SNR}(t)=exp(-\omega_\eta(t))\tag{111}\]</span></p><p><span class="math inline">\(\omega_\eta(t)\)</span>æ˜¯ä¸€ä¸ªå•è°ƒé€’å¢çš„NNï¼Œäºæ˜¯ç»“åˆä»¥ä¸Šçš„å¼å­å°±å¯ä»¥ä¼˜é›…çš„è¡¨ç¤º <spanclass="math inline">\(\bar\alpha_t\)</span> ä»¥åŠ <spanclass="math inline">\(1-\bar\alpha_t\)</span> çš„å€¼ï¼š</p><p><span class="math display">\[\frac{\bar\alpha_t}{1-\bar\alpha_t}=\exp(-\omega_\eta(t))\tag{112}\]</span></p><p><span class="math display">\[\therefore \bar\alpha_t=sigmoid(-\omega_\eta(t))\tag{113}\]</span></p><p><span class="math display">\[\therefore 1-\bar\alpha_t=sigmoid(\omega_\eta(t))\tag{114}\]</span></p><h2 id="ä¸‰ç§ç­‰ä»·å½¢å¼">ä¸‰ç§ç­‰ä»·å½¢å¼</h2><h3 id="é¢„æµ‹å™ªå£°">é¢„æµ‹å™ªå£°</h3><p>æ ¹æ®å…¬å¼ <span class="math inline">\((69)\)</span> ï¼š</p><p><span class="math display">\[x_0=\frac{x_t-\sqrt{1-\bar\alpha_t}\epsilon_0}{\sqrt{\bar\alpha_t}}\tag{115}\]</span></p><p>ä»£å…¥åˆ°å‡å€¼<span style="color: #eb52f7"> <span class="math"><spanclass="math inline">\(\mu_q(x_t,x_0)\)</span></span> </span>ï¼š</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204640841.png" /></p><p>äºæ˜¯è¿‘ä¼¼çš„å‡å€¼<span style="color: #4eb31c"> <span class="math"><spanclass="math inline">\(\mu_\theta(x_t,t)\)</span></span> </span>ï¼š</p><p><span class="math display">\[\mu_\theta(x_t,t)=\frac{1}{\sqrt\alpha_t}x_t-\frac{1-\alpha_t}{\sqrt{1-\bar\alpha_t}\sqrt\alpha_t}\hat\epsilon_\theta(x_t,t)\tag{125}\]</span></p><p>é‚£ä¹ˆä¼˜åŒ–é¡¹å°±å˜ä¸ºï¼š</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204649500.png" /></p><p>å› æ­¤ï¼Œé€šè¿‡é¢„æµ‹åŸå§‹å›¾åƒ <span class="math inline">\(x_0\)</span>å­¦ä¹ VDMç­‰ä»·äºå»å­¦ä¹ é¢„æµ‹å™ªå£°ï¼Œå¦å¤–ï¼Œä¸€äº›å·¥ä½œä¹Ÿå‘ç°é¢„æµ‹å™ªå£°ä¼šæœ‰æ›´å¥½çš„è¡¨ç°ã€‚</p><h3 id="é¢„æµ‹åˆ†æ•°">é¢„æµ‹åˆ†æ•°</h3><p><strong><spanstyle="color: #ff2020">Tweedieå…¬å¼</span></strong>ï¼š<u>ç»™å®šä»æŒ‡æ•°æ—åˆ†å¸ƒä¸­çš„æ ·æœ¬çš„çœŸå®å¹³å‡å€¼å¯ä»¥é€šè¿‡æ ·æœ¬çš„æœ€å¤§ä¼¼ç„¶ä¼°è®¡ï¼ˆç»éªŒå¹³å‡å€¼ï¼‰åŠ ä¸Šä¸€äº›æ¶‰åŠä¼°è®¡åˆ†æ•°çš„æ ¡æ­£é¡¹å¾—åˆ°</u></p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204656451.png" /></p><p><span class="math display">\[\mathbb E[\mu_z|z]=z+\Sigma_z\nabla_z\log p(z)\]</span></p><p>åœ¨VDMé‡Œé¢ï¼Œé€šå¸¸è¢«ç”¨æ¥å‡å°‘æ ·æœ¬çš„åå·®ï¼Œå¦‚æœè§‚æµ‹æ ·æœ¬éƒ½åœ¨æ½œåœ¨åˆ†å¸ƒçš„ä¸€ç«¯ï¼Œé‚£ä¹ˆè´Ÿçš„åˆ†æ•°å°†ä¼šå˜å¤§å¹¶ä¸”æ ¡æ­£åŸå§‹çš„æ ·æœ¬çš„æœ€å¤§ä¼¼ç„¶ä¼°è®¡ä¸ºæ­£ç¡®çš„å‡å€¼ã€‚æˆ‘ä»¬ä½¿ç”¨å®ƒæ¥é¢„æµ‹ç»™å®šåéªŒå™¨æ ·æœ¬åçš„<span class="math inline">\(x_t\)</span> çš„çœŸå®å‡å€¼ï¼Œæˆ‘ä»¬çŸ¥é“ï¼š<spanclass="math inline">\(q(x_t|x_0)=\mathcalN(x_t;\sqrt{\bar\alpha_t}x_0,(1-\bar\alpha_t)\mathbf I)\)</span>ï¼Œäºæ˜¯æ ¹æ® Tweedieå…¬å¼ï¼š</p><p><span class="math display">\[\mathbb E[\mu_{x_t}|x_t]=x_t+(1-\bar\alpha_t)\nabla_{x_t}\logp(x_t)\tag{131}\]</span></p><p>äºæ˜¯ï¼š</p><p><span class="math display">\[\sqrt{\bar\alpha_t}x_0=x_t+(1-\bar\alpha_t)\nabla\log p(x_t)\tag{132}\]</span></p><p><span class="math display">\[\therefore x_0=\frac{x_t+(1-\bar\alpha_t)\nabla\logp(x_t)}{\sqrt{\bar\alpha_t}}\tag{133}\]</span></p><p>å†æ¬¡ä»£å…¥åˆ°å‡å€¼<span style="color: #eb52f7"> <span class="math"><spanclass="math inline">\(\mu_q(x_t,x_0)\)</span></span> </span>ï¼š</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204703788.png" /></p><p>äºæ˜¯è¿‘ä¼¼çš„å‡å€¼<span style="color: #4eb31c"> <span class="math"><spanclass="math inline">\(\mu_\theta(x_t,t)\)</span></span> </span>ï¼š</p><p><span class="math display">\[\mu_\theta(x_t,t)=\frac{1}{\sqrt\alpha_t}x_t+\frac{1-\alpha_t}{\sqrt\alpha_t}s_\theta(x_t,t)\tag{143}\]</span></p><p>é‚£ä¹ˆä¼˜åŒ–é¡¹å°±å˜ä¸ºï¼š</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204716491.png" /></p><p>åœ¨è¿™é‡Œï¼Œ<span class="math inline">\(s_\theta(x_t,t)\)</span>æ˜¯ä¸€ä¸ªNNç”¨æ¥å­¦ä¹ é¢„æµ‹åˆ†æ•°å‡½æ•° <spanclass="math inline">\(\nabla_{x_t}\log p(x_t)\)</span>,ä¹Ÿå°±æ˜¯åœ¨ä»»æ„å™ªå£°æ°´å¹³ <span class="math inline">\(t\)</span> ä¸‹ï¼Œ <spanclass="math inline">\(x_t\)</span> åœ¨æ•°æ®ç©ºé—´ä¸­çš„æ¢¯åº¦</p><h3 id="äºŒè€…è”ç³»">äºŒè€…è”ç³»</h3><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204723658.png" /></p><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸¤è€…ä¹‹é—´å­˜åœ¨ä¸€ä¸ªéšæ—¶é—´å˜åŒ–çš„å¸¸æ•°å› å­ï¼åˆ†æ•°å‡½æ•°è¡¡é‡åº”è¯¥åœ¨æ•°æ®ç©ºé—´ä¸­å¦‚ä½•ç§»åŠ¨æ¥æœ€å¤§åŒ–å¯¹æ•°ä¼¼ç„¶ï¼›</p><blockquote><p><span class="highlight"data-annotation="%7B%22attachmentURI%22%3A%22http%3A%2F%2Fzotero.org%2Fusers%2F12736052%2Fitems%2FWHZV587X%22%2C%22annotationKey%22%3A%22X3LSTVZJ%22%2C%22color%22%3A%22%23ff6666%22%2C%22pageLabel%22%3A%2217%22%2C%22position%22%3A%7B%22pageIndex%22%3A16%2C%22rects%22%3A%5B%5B341.366%2C297.306%2C539.996%2C307.269%5D%2C%5B72%2C285.351%2C540%2C295.314%5D%2C%5B72%2C273.395%2C290.539%2C283.358%5D%5D%7D%2C%22citationItem%22%3A%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F12736052%2Fitems%2FJC7NRMH3%22%5D%2C%22locator%22%3A%2217%22%7D%7D"data-ztype="zhighlight"><a href="zotero://open-pdf/library/items/WHZV587X?page=17&#x26;annotation=X3LSTVZJ">â€œintuitively,since the source noise is added to a natural image to corrupt it, movingin its opposite direction "denoises" the image and would be the bestupdate to increase the subsequent log probability.â€</a></span> <spanclass="citation"data-citation="%7B%22citationItems%22%3A%5B%7B%22uris%22%3A%5B%22http%3A%2F%2Fzotero.org%2Fusers%2F12736052%2Fitems%2FJC7NRMH3%22%5D%2C%22locator%22%3A%2217%22%7D%5D%2C%22properties%22%3A%7B%7D%7D"data-ztype="zcitation">(<spanclass="citation-item"><a href="zotero://select/library/items/JC7NRMH3">Luo,2022, p. 17</a></span>)</span>ğŸ”¤ç›´è§‚ä¸Šï¼Œç”±äºæºå™ªå£°è¢«æ·»åŠ åˆ°è‡ªç„¶å›¾åƒä¸­ä»¥ç ´åå®ƒï¼Œå› æ­¤æ²¿å…¶ç›¸åæ–¹å‘ç§»åŠ¨ä¼šå¯¹å›¾åƒè¿›è¡Œâ€œå»å™ªâ€ï¼Œå¹¶ä¸”å°†æ˜¯å¢åŠ åç»­å¯¹æ•°æ¦‚ç‡çš„æœ€ä½³æ›´æ–°ã€‚ğŸ”¤</p></blockquote><p>äºæ˜¯ï¼Œå­¦ä¹ å»ºæ¨¡åˆ†æ•°å‡½æ•°å°±ç­‰ä»·äºå»ºæ¨¡åŸå™ªå£°çš„è´Ÿå€¼(ä¹˜ä¸Šä¸€ä¸ªæ¯”ä¾‹å› å­)</p><p>å› æ­¤ï¼Œæˆ‘ä»¬æœ‰ä¸‰ç§ç­‰ä»·ç›®æ ‡ï¼šé¢„æµ‹åŸå§‹å›¾åƒ <spanclass="math inline">\(x_0\)</span> ã€æºå™ªå£° <spanclass="math inline">\(\epsilon_0\)</span> ã€ä»»æ„å™ªå£°æ°´å¹³æ—¶çš„å›¾åƒçš„åˆ†æ•°<span class="math inline">\(\nabla\log p(x_0)\)</span></p>]]></content>
    
    
    
    <tags>
      
      <tag>Diffusion</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>IR-SDE</title>
    <link href="/2023/11/13/IR-SDE/"/>
    <url>/2023/11/13/IR-SDE/</url>
    
    <content type="html"><![CDATA[<h1id="image-restoration-with-mean-reverting-stochastic-differential-equations">ImageRestoration with Mean-Reverting Stochastic Differential Equations</h1><h2 id="èƒŒæ™¯">èƒŒæ™¯</h2><p>ä»¥å¾€çš„æ–¹æ³•çš„åå‘è¿‡ç¨‹ä¼šåˆå§‹åŒ–ä¸€ä¸ªè¾ƒé«˜æ–¹å·®çš„å™ªå£°ï¼Œå¯èƒ½ä¼šå¯¼è‡´ground-truthé«˜è´¨é‡å›¾åƒçš„æ¢å¤æ•ˆæœä¸å¥½ï¼Œè™½ç„¶å¯ä»¥è·å¾—è¾ƒé«˜çš„æ„ŸçŸ¥åˆ†æ•°ï¼Œä½†æ˜¯å¾€å¾€ä¼šåœ¨åŸºäºåƒç´ æˆ–ç»“æ„çš„é€€åŒ–æ ‡å‡†æ–¹é¢è¡¨ç°ä¸å¤ªæ»¡æ„ã€‚</p><h2 id="è´¡çŒ®">è´¡çŒ®</h2><p>ä¸ºä¸€èˆ¬çš„IRé—®é¢˜æå‡ºä¸€ç§SDEæ–¹æ³•ã€‚mean-recertingSDEå…³é”®æ€æƒ³ï¼š<strong>å°†é«˜è´¨é‡çš„å›¾åƒè½¬æ¢ä¸ºé€€åŒ–å›¾åƒï¼Œä½œä¸ºå…·æœ‰å›ºå®šé«˜æ–¯å™ªå£°çš„å‡å€¼çŠ¶æ€</strong>ï¼Œç„¶åå»ä¼°è®¡reverse-timeSDEï¼Œä¸éœ€è¦æœ‰ä»»ä½•task-specificçš„å…ˆéªŒçŸ¥è¯†ã€‚æå‡ºäº†æœ€å¤§ä¼¼ç„¶ç›®æ ‡å­¦ä¹ ä¼˜åŒ–çš„reverseè½¨è¿¹ã€‚</p><h2 id="æ–¹æ³•">æ–¹æ³•</h2><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204203262.png" /></p><h3 id="å‰å‘è¿‡ç¨‹">å‰å‘è¿‡ç¨‹</h3><p><span class="math display">\[dx=\theta_t(\mu-x)dt+\sigma_tdw\]</span></p><p><span class="math inline">\(\mu\)</span> ä¸ºçŠ¶æ€å‡å€¼ï¼Œ<spanclass="math inline">\(\theta_t,\sigma_t\)</span>æ˜¯ä¸æ—¶é—´ç›¸å…³çš„æ­£å‚æ•°ï¼Œåˆ†åˆ«è¡¨å¾äº†å‡å€¼æ¢å¤å’Œéšæœºæ³¢åŠ¨çš„é€Ÿåº¦ã€‚<spanclass="math inline">\(\mu\)</span> ä¸ <spanclass="math inline">\(x(0)\)</span>åˆ†åˆ«ä¸ºé€€åŒ–çš„LQå›¾åƒå’Œground-truthçš„HQå›¾åƒå¯¹ã€‚ç”±äº<spanclass="math inline">\(\mu\)</span> ä¾èµ–äº<spanclass="math inline">\(x(0)\)</span> ï¼Œ<spanclass="math inline">\(x(0)\)</span>ä¸å¸ƒæœ—è¿åŠ¨æ— å…³ï¼Œå› æ­¤è¯¥SDEåœ¨ä¼Šè—¤å½¢å¼ä¸Šä¾ç„¶æœ‰æ•ˆã€‚ ä»¤<spanclass="math inline">\(\sigma_t^2/\theta_t=2\lambda^2\)</span> ï¼Œ<spanclass="math inline">\(\lambda^2\)</span> ä¸ºå›ºå®šçš„æ–¹å·®ã€‚ç»™å®šä»»æ„çš„ <spanclass="math inline">\(x(s),s&lt;t\)</span> ï¼ŒSDEçš„è§£ä¸º: <spanclass="math display">\[x(t)=\mu+(x(s)-\mu)e^{-\bar\theta_{s:t}}+\int_s^t\sigma_ze^{-\bar\theta_{z:t}}dw(z)\]</span> <spanclass="math inline">\(\bar\theta_{s:t}:=\int_s^t\theta_zdz\)</span>å·²çŸ¥ï¼Œåˆ™ä¸­é—´çš„è½¬ç§»æ­¥ <span class="math inline">\(p(x(t)|x(s))=\mathcalN(x(t)|m_{s:t}(x(s)),v_{s:t})\)</span> ï¼š <span class="math display">\[m_{s:t}(x(s)):=\mu+(x(s)-\mu)e^{-\bar\theta_{s:t}},\\v_{s:t}:=\int_s^t\sigma_z^2e^{-2\bar\theta_{z:t}}dz\\=\lambda^2(1-e^{-2\bar\theta_{s:t}})\]</span></p><blockquote><p>è¯æ˜ï¼š</p><p>éœ€æ±‚è§£çš„SDEï¼š <span class="math display">\[\mathrm dx=\theta_t(\mu-x)\mathrm dt+\sigma_t \mathrm dw\]</span> ä¸ºç®€ä¾¿ï¼Œä½¿ç”¨ <span class="math inline">\(\bar\theta_t\)</span>æ›¿æ¢ <span class="math inline">\(\bar\theta_{0:t}\)</span>ï¼Œå®šä¹‰ä¸€ä¸ªä»£ç†å¯å¾®å‡½æ•°(æ–¹ä¾¿æ±‚è§£)ï¼š <span class="math display">\[\psi(x,t)=x\mathrm e^{\bar\theta_t}\]</span> æ ¹æ®ä¼Šè—¤å…¬å¼ï¼š <span class="math display">\[\mathrm d\psi(x,t)=\frac{\partial\psi}{\partial t}(x,t)\mathrmdt+\frac{\partial\psi}{\partial x}(x,t)\mathbf f(x,t)\mathrm dt\\+\frac12\frac{\partial^2\psi}{\partial x^2}(x,t)g(t)^2\mathrm dt\\+\frac{\partial\psi}{\partial x}(x,t)g(t)\mathrm {dw_t}\]</span></p><p>å°†å¼ <span class="math inline">\((4)\)</span> ä»£å…¥ <spanclass="math inline">\((6)\)</span> å¾—: <span class="math display">\[\mathrm d\psi(x,t)=\mu\theta_t\mathrm e^{\bar\theta_t}\mathrmdt+\sigma_t\mathrm e^{\bar\theta_t}\mathrm{dw}_t\]</span> ç§¯åˆ†å¾—ï¼š <span class="math display">\[\psi(x,t)-\psi(x,s)=\int_s^t\mu\theta_z\mathrm e^{\bar\theta_z}\mathrmdz+\int_s^t\sigma_z\mathrm e^{\bar\theta_z}\mathrm{dw}(z)\]</span> åœ¨è¿™é‡Œï¼Œ<span class="math inline">\(\int_s^t\sigma_z\mathrme^{\bar\theta_z}\mathrm{dw}(z)\sim\mathcal N(0,\int_s^t\sigma^2_z\mathrme^{2\bar\theta_z}dz)\)</span></p><blockquote><p>è¯æ˜ï¼š <span class="math display">\[Var(\int_s^tH_zdW(z))\approxVar(\sum_{i=1}^NH_{t_i}(W_{t_i}-W_{t_{i-1}}))\\=\sum_{i=1}^NVar(H_{t_i}(W_{t_i}-W_{t_{i-1}}))\\=\sum_{i=1}^NH_{t_i}^2Var(W_{t_i}-W_{t_{i-1}})\\=\sum_{i=1}^NH_{t_i}^2(t_i-t_{i-1})\]</span></p><p><span class="math display">\[\lim_{max \Deltat_i\to0}\sum_{i=1}^NH_{t_i}^2(t_i-t_{i-1})=\int_s^tH_z^2dz\]</span></p></blockquote><p>ç”±äº <span class="math inline">\(\mathrm d\bar\theta_t=\mathrmd\int_0^t\theta_z\mathrm dz=\theta_t\)</span> ,äºæ˜¯ï¼š <spanclass="math display">\[x(t)\mathrm e^{\bar\theta_t}-x(s)\mathrm e^{\bar\theta_s}=\mu(\mathrme^{\bar\theta_t}-\mathrm e^{\bar\theta_s})+\int_s^t\sigma_z\mathrme^{\bar\theta_z}\mathrm{dw}(z)\]</span> ä¸¤è¾¹åŒæ—¶é™¤ä»¥ <span class="math inline">\(\mathrme^{\bar\theta_t}\)</span> å¾—ï¼š <span class="math display">\[x(t)=\mu+(x(s)-\mu)\mathrm e^{-\bar\theta_{s:t}}+\int_s^t\sigma_z\mathrme^{-\bar\theta_{z:t}}\mathrm {dw}_z\]</span></p><p><span class="math display">\[\int_s^t\sigma_z^2\mathrm e^{-2\bar\theta_{z:t}}\mathrmdz=\frac{\sigma_t^2}{2\theta_t}e^0-\frac{\sigma^2_s}{2\theta_s}\mathrme^{-2\bar\theta_{s:t}}=\lambda^2(1-\mathrm e^{-2\bar\theta_{s:t}})\]</span></p><p>è¯æ¯•</p></blockquote><p>å½“ <span class="math inline">\(t\to\infty\)</span> æ—¶ï¼Œ<spanclass="math inline">\(m_t\)</span> è¶‹äºLQå›¾åƒ <spanclass="math inline">\(\mu\)</span> ï¼Œ<spanclass="math inline">\(v_t\)</span> è¶‹äº <spanclass="math inline">\(\lambda^2\)</span>ï¼Œå³SDEå°†HQå›¾åƒæ‰©æ•£åˆ°LQå›¾åƒåŠ ä¸€å¼ å›ºå®šé«˜æ–¯å™ªå£°ã€‚</p><h3 id="åå‘è¿‡ç¨‹">åå‘è¿‡ç¨‹</h3><p><span class="math display">\[\mathrm dx=[\theta_t(\mu-x)-\sigma^2_t\nabla_x\logp_t(x)]dt+\sigma_t\mathrm d\hat w\]</span></p><p>æ¯ä¸€æ­¥çš„ground-truth score: <span class="math display">\[\nabla_x\log p_t(x|x(0))=-\frac{x(t)-m_t(x)}{v_t}\]</span> é‡æ–°å‚æ•°åŒ– <spanclass="math inline">\(x(t)=m_t(x)+\sqrt{v_t}\epsilon_t,\epsilon\sim\mathcaln(0,I)\)</span> ,äºæ˜¯ï¼š <span class="math display">\[\nabla_x\log p_t(x|x(0))=-\frac{\epsilon_t}{\sqrt v_t}\]</span> è®­ç»ƒå™ªå£°ä¼°è®¡ç½‘ç»œ <spanclass="math inline">\(\tilde\epsilon_\phi(x(t),\mu,t)\)</span> : <spanclass="math display">\[L_\gamma(\phi):=\sum_{i=1}^{T}\gamma_i\mathbbE[\left\|\tilde\epsilon_\phi(x(t),\mu,t)-\epsilon_i\right\|]\]</span>ä¸Šå¼è™½ç„¶æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯å¾€å¾€åº”ç”¨åˆ°å¤æ‚é€€åŒ–åœºæ™¯æ—¶ä¼šä¸ç¨³å®šã€‚åŸå› ï¼šè¯•å›¾å­¦ä¹ ç»™å®šæ—¶é—´çš„ç¬æ—¶å™ªå£°ã€‚</p><p><strong>è§£å†³æ–¹æ³•ï¼š</strong> æå‡ºæœ€å¤§ä¼¼ç„¶ç›®æ ‡å°è¯•å¯»æ‰¾ç»™å®š <spanclass="math inline">\(x_0\)</span> å <spanclass="math inline">\(x_{1:T}\)</span>çš„æœ€ä¼˜è½¨è¿¹ï¼ˆè€Œä¸æ˜¯æ›´å‡†ç¡®çš„åˆ†æ•°å‡½æ•°ï¼‰</p><p>æœ€å¤§ä¼¼ç„¶ç›®æ ‡ï¼š <span class="math display">\[p(x_{1:T}|x_0)=p(x_T|x_0)\prod_{i=2}^Tp(x_{i-1}|x_i,x_0)\]</span> äºæ˜¯æœ€ä½³åå‘çŠ¶æ€ä¸ºæœ€å°åŒ–è´Ÿçš„å¯¹æ•°ä¼¼ç„¶ï¼š <spanclass="math display">\[x_{i-1}^*=\underset{x_{i-1}}{\mathrm{arg\ min}}[-\logp(x_{i-1}|x_i,x_0)]\]</span> ä»¤ <spanclass="math inline">\(\theta&#39;_i:=\int_{i-1}^i\theta_t\mathrmdt\)</span> ,é€šè¿‡æ±‚è§£å¯å¾—æœ€ä¼˜è½¨è¿¹ï¼š <span class="math display">\[x_{i-1}^*=\frac{1-\mathrm e^{-2\bar\theta_{i-1}}}{1-\mathrme^{-2\bar\theta_i}}\mathrm e^{-\theta&#39;_i}(x_i-\mu)\\+\frac{1-\mathrm e^{-2\theta_i&#39;}}{1-\mathrme^{\bar\theta_i}}(x_0-\mu)+\mu\]</span></p><blockquote><p>è¯æ˜ï¼š</p><p>æ ¹æ®è´å¶æ–¯è§„åˆ™ <span class="math display">\[-\logp(x_{i-1}|x_i,x_0)=-\log\frac{p(x_i|x_{i-1},x_0)p(x_{i-1}|x_0)}{p(x_i|x_0)}\\\propto -\log p(x_i|x_{i-1},x_0)-\log p(x_{i-1}|x_0)\]</span> ä»¤è´Ÿçš„å¯¹æ•°ä¼¼ç„¶çš„æ¢¯åº¦ä¸º0ï¼š</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204213481.png" /></p><p>è¯æ¯•ï¼ŒäºŒé˜¶å¯¼æ•°ä¸ºæ­£ï¼Œå› æ­¤ <spanclass="math inline">\(x_{i-1}^*\)</span> ç¡®å®ä¸ºæœ€ä¼˜ç‚¹</p></blockquote><p>è®­ç»ƒå™ªå£°ä¼°è®¡ç½‘ç»œ <spanclass="math inline">\(\tilde\epsilon_\phi(x_i,\mu,i)\)</span> : <spanclass="math display">\[J_\gamma(\phi):=\sum_{i=1}^T\gamma_i\mathbbE[\left\|x_i-(dx_i)_{\tilde\epsilon_\phi}-x_{i-1}^*\right\|]\]</span> <spanclass="math inline">\((dx_i)_{\tilde\epsilon_\phi}\)</span> ä¸ºå¼ <spanclass="math inline">\((14)\)</span> çš„åå‘SDEï¼Œå…¶ä¸­åˆ†æ•°ç”± <spanclass="math inline">\(\tilde\epsilon_\phi\)</span>ä¼°è®¡ï¼Œç”±äºæ‰©æ•£é¡¹çš„æœŸæœ›ä¸º0ï¼Œäºæ˜¯åªéœ€è¦è€ƒè™‘æ¼‚ç§»é¡¹ã€‚</p><h2 id="å®éªŒ">å®éªŒ</h2><h3 id="deraining">Deraining</h3><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204222675.png" /></p><h3 id="debluring">Debluring</h3><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204230422.png" /></p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204238169.png" /></p><h3 id="gaussian-image-denoising">Gaussian Image Denoising</h3><p>æå‡ºDenoising-SDEï¼šå°†å¹²å‡€å›¾åƒè®¾ä¸ºå‡å€¼ <spanclass="math inline">\(\mu=x_0\)</span>ï¼Œå¯ä»¥ä»¥æ›´å°‘çš„æ—¶é—´æ­¥è¿›è¡Œå»å™ªã€‚å› æ­¤å¯ä»¥å°†ä»»æ„å™ªå£°å›¾ä½œä¸ºä¸­é—´çŠ¶æ€ï¼Œå°†å…¶ç›´æ¥åè½¬ä¸ºå¹²å‡€å›¾åƒã€‚</p><p>æå‡ºDenoising-ODEï¼šç”±äºåªæœ‰é«˜æ–¯å™ªå£°ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ä½¿ç”¨ODEï¼Œæ²¡æœ‰é¢å¤–çš„å™ªå£°ç›´æ¥å»å™ªï¼š<span class="math display">\[\mathrm dx=[\theta_t(\mu-x)-\sigma^2_t\nabla_x\log p_t(x)]dt\]</span></p><blockquote><p><span class="math display">\[p_{noise}(x_i|x_0)=\mathcal N(m_i(x_0),v_i)\]</span></p><p>è¿™é‡Œçš„ <spanclass="math inline">\(m_i(x_0)=x_0,v_i=\lambda^2(1-e^{-2\bar\theta_i})\)</span>ï¼Œæœ€ä¼˜è½¨è¿¹å˜ä¸ºï¼š <span class="math display">\[x_{i-1}^*=\frac{1-\mathrm e^{-2\bar\theta_{i-1}}}{1-\mathrme^{-2\bar\theta_i}}\mathrm e^{-\theta&#39;_i}(x_i-x_0)+x_0\]</span></p><p><span class="math display">\[x_i=m_i+\sqrt{v_i}\epsilon_t,\epsilon\sim\mathcal N(0,I)\]</span></p><p>å°†å¼ <span class="math inline">\((26)\)</span> ä»£å…¥å¼ <spanclass="math inline">\((14)\)</span> å¾—Denoising-SDE:</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204248254.png" /></p><p>å¯¹åº”çš„ODEï¼š <span class="math display">\[dx=-\frac12\sigma_t^2\mathrm e^{-2\bar\theta_t}\nabla_{x_t}\log p_t(x)dt\]</span> ä¸€æ—¦çŸ¥é“çœŸå®å™ªå£°æ°´å¹³ <spanclass="math inline">\(\sigma_{real}\)</span> åˆ™å¯ä»¥ç›´æ¥æ¨å‡ºç›¸åº”çš„ <spanclass="math inline">\(t^*\)</span> ä½¿å¾— <spanclass="math inline">\(p_{noise}(x_i|x_0)\)</span> çš„æ–¹å·®åˆšå¥½ä¸ºå™ªå£°æ°´å¹³ï¼š<span class="math display">\[\sigma_{real}^2=v_t=\lambda^2(1-\mathrm e^{-2\bar\theta_t})\]</span> äºæ˜¯ï¼š <span class="math display">\[t^*=\underset{t}{arg\ min}\left\|\bar\theta_t-\frac1{2\Delta t}\log(1-\frac{\sigma_{real}^2}{\lambda^2    })\right\|\]</span></p></blockquote><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204257143.png" /></p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204304756.png" /></p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207204311705.png" /></p><h2 id="å±€é™ä¸æœªæ¥æ–¹å‘">å±€é™ä¸æœªæ¥æ–¹å‘</h2><p><span class="math inline">\(v_t\)</span>ä¸­çš„æŒ‡æ•°é¡¹ä¼šä½¿å¾—åœ¨æœ€åå‡ æ­¥çš„æ–¹å·®å˜å¾—è¿‡äºå¹³æ»‘ï¼Œä½¿å¾—ç›¸é‚»çŠ¶æ€å¾ˆç›¸ä¼¼ï¼Œä½¿å¾—å­¦ä¹ å˜å¾—å›°éš¾ã€‚<strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šæ”¹è¿›<span class="math inline">\(\theta\)</span> æ—¶é—´è¡¨ã€‚</p><p>é‡‡æ ·æ­¥éª¤çš„ä¼˜åŒ–ï¼Œä»¥å‡å°‘è®¡ç®—æˆæœ¬</p><h2 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h2><p>Luo, Ziwei, Fredrik K. Gustafsson, Zheng Zhao, Jens SjÃ¶lund, andThomas B. SchÃ¶n. â€œImage Restoration with Mean-Reverting StochasticDifferential Equations.â€ arXiv, May 31, 2023.http://arxiv.org/abs/2301.11699.</p>]]></content>
    
    
    
    <tags>
      
      <tag>SDE</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åŸºäºåˆ†æ•°çš„ç”Ÿæˆæ¨¡å‹</title>
    <link href="/2023/11/12/Understanding%20diffusion%E5%9F%BA%E4%BA%8E%E5%88%86%E6%95%B0%E7%9A%84%E6%A8%A1%E5%9E%8B/"/>
    <url>/2023/11/12/Understanding%20diffusion%E5%9F%BA%E4%BA%8E%E5%88%86%E6%95%B0%E7%9A%84%E6%A8%A1%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="åŸºäºåˆ†æ•°çš„ç”Ÿæˆæ¨¡å‹">åŸºäºåˆ†æ•°çš„ç”Ÿæˆæ¨¡å‹</h1><h2 id="åŸºäºèƒ½é‡çš„æ¨¡å‹">åŸºäºèƒ½é‡çš„æ¨¡å‹</h2><p>ä»»æ„åˆ†å¸ƒéƒ½å¯ä»¥è¢«å†™ä¸ºï¼š <span class="math display">\[p_\theta(x)=\frac{1}{Z_\theta}e^{-f_\theta(x)}\tag{152}\]</span></p><p><span class="math inline">\(f_\theta(x)\)</span>æ˜¯ä¸€ä¸ªä»»æ„çš„ã€å‚æ•°åŒ–çš„å‡½æ•°â€”â€”èƒ½é‡å‡½æ•°ï¼Œé€šå¸¸è¢«å»ºæ¨¡ä¸ºä¸€ä¸ªNNï¼Œ<spanclass="math inline">\(Z_\theta\)</span> æ˜¯æ­£åˆ™åŒ–å¸¸æ•°ä½¿å¾— <spanclass="math inline">\(\int p_\theta(x)dx=1\)</span>,å¦‚æœä½¿ç”¨æœ€å¤§ä¼¼ç„¶ä¼°è®¡ï¼Œå¯¹å¤æ‚çš„ <spanclass="math inline">\(f_\theta(x)\)</span> æ¥è¯´ï¼Œ<spanclass="math inline">\(Z_\theta\)</span> å¯èƒ½éš¾ä»¥å¤„ç†</p><h2 id="åˆ†æ•°æ¨¡å‹">åˆ†æ•°æ¨¡å‹</h2><p>ä¸Šé¢çš„é—®é¢˜å¯ä»¥ä½¿ç”¨ä¸€ä¸ªNN <spanclass="math inline">\(s_\theta(x)\)</span> æ¥å­¦ä¹  <spanclass="math inline">\(p(x)\)</span> çš„åˆ†æ•°å‡½æ•° <spanclass="math inline">\(\nabla\log p(x)\)</span> æ‰€é¿å…ã€‚åŠ¨æœºï¼š</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207200915631.png" /></p><p>å› æ­¤ä¸éœ€è¦è¡¨ç¤ºä»»ä½•æ­£åˆ™åŒ–å¸¸æ•°ï¼Œåˆ†æ•°æ¨¡å‹å¯ä»¥é€šè¿‡æœ€å°åŒ–Fisheræ•£åº¦æ¥ä¼˜åŒ–ï¼š</p><p><span class="math display">\[\mathbb E_{p(x)}\Big[\left\|s_\theta(x)-\nabla\logp(x)\right\|_2^2\Big]\tag{157}\]</span> å¯¹äºæ¯ä¸ª <span class="math inline">\(x\)</span>æ¥è¯´ï¼Œå®ƒçš„å¯¹æ•°ä¼¼ç„¶çš„æ¢¯åº¦æ ¹æœ¬ä¸Šæè¿°äº†åœ¨æ•°æ®ç©ºé—´ä¸­è¿›ä¸€æ­¥å¢åŠ å®ƒçš„å¯¹æ•°ä¼¼ç„¶çš„æ–¹å‘ã€‚ç›´è§‰ä¸Šï¼Œåˆ†æ•°å‡½æ•°åœ¨æ•°æ®x æ‰€åœ¨çš„æ•´ä¸ªç©ºé—´ä¸Šå®šä¹‰äº†ä¸€ä¸ªå‘é‡åœºï¼ŒæŒ‡å‘ä¼—æ•°ï¼š</p><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207200928758.png" /></p><p>é€šè¿‡å­¦ä¹ çœŸå®æ•°æ®åˆ†å¸ƒçš„åˆ†æ•°å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä»ç›¸åŒç©ºé—´ä¸­çš„ä»»ä¸€ç‚¹å¼€å§‹ï¼Œé€æ¸åœ°è·Ÿéšåˆ†æ•°ç›´åˆ°æ¨¡å¼åˆ°è¾¾æ¥ç”Ÿæˆæ ·æœ¬ã€‚é‡‡æ ·è¿‡ç¨‹ä¸ºå·²çŸ¥çš„éƒä¹‹ä¸‡é‡‡æ ·ï¼š<span class="math display">\[x_{i+1}\gets x_i+c\nabla\log p(x_i)+\sqrt{2c}\epsilon,\i=0,1,...,K\tag{158}\]</span> <span class="math inline">\(x_0\)</span>æ˜¯ä»å…ˆéªŒåˆ†å¸ƒä¸­éšæœºé‡‡æ ·ï¼Œ<span class="math inline">\(\epsilon\sim\mathcalN(\epsilon;\mathbf 0,\mathbf I)\)</span>æ˜¯ä¸€ä¸ªé¢å¤–çš„å™ªå£°é¡¹ç”¨æ¥ä¿è¯ç”Ÿæˆæ ·æœ¬ä¸æ€»æ˜¯å´©æºƒåˆ°ä¸€ä¸ªæ¨¡å¼ï¼Œè€Œæ˜¯ä¸ºäº†å¤šæ ·æ€§ç¯ç»•åœ¨å®ƒå‘¨å›´ï¼Œä¿ç•™ä¸€å®šçš„éšæœºæ€§ã€‚ç”±äºground-truthåˆ†æ•°å‡½æ•°å¯¹äºå¤æ‚åˆ†å¸ƒçš„è‡ªç„¶å›¾åƒæ¥è¯´ä¸å¯è·å–ï¼Œäºæ˜¯ä½¿ç”¨åˆ†æ•°åŒ¹é…æ–¹æ³•æ¥è§£å†³ã€‚</p><p>æ™®é€šåˆ†æ•°åŒ¹é…å­˜åœ¨ä¸‰ä¸ªé—®é¢˜ï¼š</p><ol type="1"><li><p>å½“ <span class="math inline">\(x\)</span>åœ¨é«˜ç»´ç©ºé—´çš„ä½ç»´æµå½¢ä¸Šæ—¶ï¼Œåˆ†æ•°å‡½æ•°æ˜¯ä¸æ˜ç¡®çš„ã€‚æ‰€æœ‰ä¸åœ¨ä½ç»´æµå½¢çš„ç‚¹çš„æ¦‚ç‡ä¸º0ï¼Œæ­¤æ—¶å¯¹æ•°æ²¡æœ‰å®šä¹‰ï¼Œè€Œè‡ªç„¶å›¾åƒé€šå¸¸åœ¨æ•´ä¸ªç¯å¢ƒç©ºé—´çš„ä½ç»´æµå½¢ä¸Š</p></li><li><p>é€šè¿‡æ™®é€šåˆ†æ•°åŒ¹é…è®­ç»ƒçš„åˆ†æ•°å‡½æ•°åœ¨ä½å¯†åº¦åŒºåŸŸå¯èƒ½æ˜¯ä¸æ­£ç¡®çš„ï¼Œå› ä¸ºæˆ‘ä»¬æœ€å°åŒ–çš„ç›®æ ‡æ˜¯å…³äº<span class="math inline">\(p(x)\)</span>çš„æœŸæœ›ï¼Œä»å®ƒçš„æ ·æœ¬ä¸­è®­ç»ƒï¼Œæ¨¡å‹æ— æ³•æ¥æ”¶åˆ°å¾ˆå°‘è§æˆ–è€…çœ‹ä¸åˆ°çš„æ ·æœ¬çš„æ­£ç¡®çš„å­¦ä¹ ä¿¡å·ã€‚ï¼ˆé‡‡æ ·ç­–ç•¥æ˜¯é«˜ç»´ç©ºé—´çš„éšæœºä½ç½®å¼€å§‹ï¼Œå¾ˆå¯èƒ½æ˜¯éšæœºå™ªå£°ï¼‰</p></li><li><p>éƒä¹‹ä¸‡åŠ¨åŠ›é‡‡æ ·å¯èƒ½ä¸ä¼šæ‹Ÿåˆï¼Œå³ä½¿ä½¿ç”¨ground-truthåˆ†æ•°ï¼š</p><blockquote><p>å‡è®¾çœŸå®æ•°æ®åˆ†å¸ƒæ˜¯ä¸¤ä¸ªä¸ç›¸äº¤çš„åˆ†å¸ƒçš„æ··åˆ <spanclass="math display">\[p(x)=c_1p_1(x)+c_2p_2(x)\tag{159}\]</span>åœ¨è®¡ç®—åˆ†æ•°æ—¶ï¼Œå®ƒä»¬çš„æ··åˆç³»æ•°è¢«ä¸¢æ‰ï¼Œé‚£ä¹ˆä»å®ƒä»¬ä¸­é—´çš„åˆå§‹ç‚¹ä½¿ç”¨éƒä¹‹ä¸‡åŠ¨åŠ›å­¦é‡‡æ ·çš„è¯ï¼Œåˆ°è¾¾å®ƒä»¬æ¯ä¸ªæ¨¡å¼çš„æœºä¼šéƒ½æ˜¯ç²—ç•¥ç›¸ç­‰çš„ï¼Œå°½ç®¡å¯èƒ½æŸä¸€ä¸ªåˆ†å¸ƒçš„æƒé‡æ›´å¤§</p></blockquote><p><imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207200936664.png" /></p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šåœ¨æ•°æ®ä¸­åŠ å…¥å¤šä¸ªæ°´å¹³çš„é«˜æ–¯å™ªå£°(å»å™ªåˆ†æ•°åŒ¹é…)</p><ol type="1"><li>ç”±äºé«˜æ–¯å™ªå£°çš„å‡è®¾æ˜¯æ•´ä¸ªç©ºé—´ï¼Œäºæ˜¯æ‰°åŠ¨åçš„æ•°æ®ä¸å†å±€é™äºä½ç»´æµå½¢</li><li>åŠ å…¥è¾ƒå¤§çš„é«˜æ–¯å™ªå£°å°†å¢å¤§æ¯ç§æ¨¡å¼åœ¨æ•°æ®åˆ†å¸ƒä¸­è¦†ç›–çš„é¢ç§¯ï¼Œåœ¨ä½å¯†åº¦åŒºåŸŸå¢åŠ äº†æ›´å¤šè®­ç»ƒä¿¡å·</li><li>åŠ å…¥å¤šä¸ªæ°´å¹³çš„é«˜æ–¯å™ªå£°å¹¶å¢åŠ æ–¹å·®å°†ä½¿å¾—ç»“æœçš„ä¸­é—´åˆ†å¸ƒå°Šé‡ground-truthçš„æ··åˆç³»æ•°</li></ol><p>äºæ˜¯ï¼Œå½¢å¼ä¸Šï¼Œé€‰æ‹©æ­£çš„å™ªå£°æ°´å¹³åºåˆ— <spanclass="math inline">\(\{\sigma_t\}_{t=1}^T\)</span>ï¼Œä»¥åŠå®šä¹‰ä¸€ä¸ªé€æ¸æ‰°åŠ¨æ•°æ®åˆ†å¸ƒçš„åºåˆ—ï¼š <span class="math display">\[p_{\sigma_t}(x_t)=\int p(x)\mathcal N(x_t;x,\sigma_t^2\mathbfI)dx\tag{160}\]</span> <span class="math inline">\(s_\theta(x,t)\)</span>ä½¿ç”¨<strong>åˆ†æ•°åŒ¹é…</strong>è®­ç»ƒå­¦ä¹ åŒæ—¶æ‰€æœ‰å™ªå£°æ°´å¹³çš„åˆ†æ•°å‡½æ•°ï¼š <spanclass="math display">\[\underset{\theta}{arg\ min}\sum_{t=1}^T\lambda(t)\mathbbE_{p_{\sigma_t}(x_t)}\Big[\left\|s_\theta(x,t)-\nabla\logp_{\sigma_t}(x_t)\right\|_2^2\Big]\tag{161}\]</span></p></li></ol><p><span class="math inline">\(\lambda(t)\)</span>æ˜¯æ­£çš„æƒé‡å‡½æ•°ï¼Œé€šå¸¸è¢«é€‰æ‹©ä¸º <spanclass="math inline">\(\lambda(i)=\sigma_i^2\)</span>ç”±äºå™ªå£°æ°´å¹³éšç€æ—¶é—´ç¨³å®šä¸‹é™ï¼Œå› æ­¤è¦éšç€æ—¶é—´å‡å°‘æ­¥é•¿ï¼Œä½¿å¾—æ ·æœ¬æœ€åé›†ä¸­åœ¨çœŸå®çš„æ¨¡å¼ä¸Šã€‚<span class="math display">\[\nabla_{x_t}\log p_{\sigma_t}(x_t)=\nabla_{x_t}\logp_{\sigma_t}(x_t|x)p(x)=\nabla_{x_t}\log p_{\sigma_t}(x_t|x)\tag{162}\]</span></p><p><span class="math display">\[\nabla_{x_t}\log p_{\sigma_t}(x_t|x)=\nabla_{x_t}\log\Big\{\frac{1}{\sqrt{2\pi}\sigma_t}\exp\Big(-\frac{(x_t-x)^2}{2\sigma_t^2}\Big)\Big\}\\=\nabla_{x_t}\Big[-\frac{(x_t-x)^2}{2\sigma_t^2}\Big]\\=-\frac{x_t-x}{\sigma_t^2}\\=-\frac{\epsilon}{\sigma_t}\tag{163}\]</span> äºæ˜¯ä¼˜åŒ–ç›®æ ‡å¯ä»¥å†™ä¸ºï¼š <span class="math display">\[\underset{\theta}{arg\ min}\sum_{t=1}^{T}\lambda(t)\mathbbE_{p_{\sigma_t}(x_t)}\Bigg[\left\|s_\theta(x,t)+\frac{x_t-x}{\sigma_t^2}\right\|_2^2\Bigg]\\=\underset{\theta}{arg\ min}\sum_{t=1}^{T}\mathbbE_{p_{\sigma_t}(x_t)}\Big[\left\|\sigma_ts_\theta(x,t)+\epsilon\right\|_2^2\Big]\tag{164}\]</span></p><h2 id="sdeæ¨å¯¼">SDEæ¨å¯¼</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œæ‰©æ•£æ¨¡å‹ä¸­ <span class="math inline">\(x_0\to x_T,x_T\tox_0\)</span> çš„è¿‡ç¨‹ä¸€ç§éšæœºè¿‡ç¨‹ï¼Œäºæ˜¯è€ƒè™‘ä½¿ç”¨éšæœºå¾®åˆ†æ–¹ç¨‹ï¼ˆStochasticDifferential Equationsï¼ŒSDEï¼‰æ¥åˆ»ç”»ã€‚</p><p>åŸå§‹æ‰©æ•£è¿‡ç¨‹ä¸ºç¦»æ•£å½¢å¼ï¼Œä½¿ç”¨SDEè¿›è¡Œè¿ç»­çš„æè¿°ï¼Œäºæ˜¯å‰å‘æ‰©æ•£è¿‡ç¨‹å¯ä»¥çœ‹ä½œä¸€ä¸ªä¼Šè—¤æ‰©æ•£è¿‡ç¨‹çš„è§£ï¼š<span class="math display">\[dx=f(x,t)dx+g(t)d\omega\]</span> å…¶ä¸­ï¼š <span class="math display">\[dx=\lim\limits_{\Delta t\to0}(x_{t+\Delta t}-x_t)\]</span> å› æ­¤åŸæ¥ç¦»æ•£å½¢å¼çš„ <span class="math inline">\(x_t\tox_{t+1}\)</span> å°±å˜ä¸ºè¿ç»­å½¢å¼çš„ <span class="math inline">\(x_{t}\tox_{t+\Delta t}\)</span> ï¼Œäºæ˜¯ï¼š <span class="math display">\[x_{t+\Delta t}=x_t+\underset{ç¡®å®šéƒ¨åˆ†}{f(x,t)\Deltat}+\underset{éšæœºéƒ¨åˆ†}{g(t)\sqrt{\Delta t}\epsilon},\epsilon\sim\mathcalN(0,I)\]</span> åŸæ¥ç¦»æ•£çš„å‰å‘è¿‡ç¨‹ï¼š<span class="math inline">\(x_0\to x_1\tox_2\to ...\to x_T\)</span> ï¼Œç°åœ¨è¿ç»­çš„å‰å‘è¿‡ç¨‹ï¼š<spanclass="math inline">\(x_0\to x_{\Delta t}\to x_{2\Delta t}\to ... \tox_T\)</span></p><p>æœ‰äº†å‰å‘è¿‡ç¨‹çš„SDEåï¼Œéœ€è¦åˆ†æåå‘è¿‡ç¨‹ä»¥è¿˜åŸçœŸå®åˆ†å¸ƒï¼Œ <spanclass="math display">\[p(x_{t+\Delta t}|x_t)=\mathcal N(x_{t+\Delta t};x_t+f(x,t)\Deltat,g^2(t)\Delta tI)\\\propto\exp(\frac{\left\|x_{t+\Delta t}-x_t-f(x,t)\Deltat\right\|^2}{2g^2(t)\Delta t})\]</span> æ ¹æ®è´å¶æ–¯è§„åˆ™ï¼š <span class="math display">\[p(x_t|x_{t+\Delta t})=\frac{p(x_{t+\Delta t}|x_t)p(x_t)}{p(x_{t+\Deltat})}\\=p(x_{t+\Delta t}|x_t)\exp(\log p(x_t)-\log p(x_{t+\Delta t}))\\=\exp(-\frac{\left\|x_{t+\Delta t}-x_t-f(x,t)\Deltat\right\|^2}{2g^2(t)\Delta t}+\log p(x_t)-\log p(x_{t+\Deltat}))\label{6}\]</span> å¯¹ <span class="math inline">\(\log p(x_{t+\Delta t})\)</span>è¿›è¡Œæ³°å‹’å±•å¼€ï¼š <span class="math display">\[\log p(x_{t+\Delta t})\approx \log p(x_t)+(x_{t+\Deltat}-x_t)\nabla_{x_t}\log p(x_t)+\Delta t\frac{\partial \logp(x_t)}{\partial t}\label{7}\]</span> å°†å…¬å¼<spanclass="math inline">\(\eqref7\)</span>ä»£å…¥å…¬å¼<spanclass="math inline">\(\eqref6\)</span>å¾—ï¼š <span class="math display">\[p(x_t|x_{t+\Delta t})\propto \exp(-\frac{\left\|x_{t+\Deltat}-x_t-f(x,t)\Delta t\right\|^2}{2g^2(t)\Delta t}+(x_{t+\Deltat}-x_t)\nabla_{x_t}\log p(x_t)-\Delta t\frac{\partial \logp(x_t)}{\partial t})\\=\exp(-\frac{\left\|x_{t+\Delta t}-x_t-[f(x,t)-g^2(t)\nabla_{x_t}\logp(x_t)]\Delta t\right\|^2}{2g^2(t)\Delta t}+\mathscr Ot)\]</span> å½“ <span class="math inline">\(\Delta t\to0\)</span> æ—¶ï¼Œ<spanclass="math inline">\(\mathscr Ot\to0\)</span> ï¼Œäºæ˜¯ï¼š <spanclass="math display">\[p(x_t|x_{t+\Delta t})\propto \exp(-\frac{\left\|x_{t+\Deltat}-x_t-[f(x,t)-g^2(t)\nabla_{x_t}\log p(x_t)]\Deltat\right\|^2}{2g^2(t)\Delta t})\\\approx \exp(-\frac{\left\|x_t-x_{t+\Delta t}+[f(x,t+\Deltat)-g^2(t+\Delta t)\nabla_{x_{t+\Delta t}}\log p(x_{t+\Delta t})]\Deltat\right\|^2}{2g^2(t+\Delta t)\Delta t})\]</span> å› æ­¤ï¼š <span class="math display">\[p(x_t|x_{t+\Delta t})=\mathcal N(x_t;x_{t+\Delta t}-[f(x,t+\Deltat)-g^2(t+\Delta t)\nabla_{x_{t+\Delta t}}\log p(x_{t+\Delta t})]\Deltat,g^2(t+\Delta t)\Delta tI)\]</span> å– <span class="math inline">\(\Delta t\to0\)</span> ï¼Œä»¥åŠ<span class="math inline">\(dx=\lim\limits_{\Delta t\to0}(x_{t+\Deltat}-x_t)\)</span> å¾—æœ€åçš„==reverse-time SDE==ï¼š <spanclass="math display">\[dx=[f(x,t)-g^2(t)\nabla_x\log p_t(x)]dt+g(t)d\omega\]</span> <imgsrc="https://typoracc.oss-cn-beijing.aliyuncs.com/img/image-20231207200945593.png" /></p><h3 id="ve-sde-vs.-vp-sde">VE-SDE vs. VP-SDE</h3><p>å°†NCSNä»¥åŠDDPMå‡è€ƒè™‘åˆ°SDEæ¡†æ¶ä¸­ï¼Œåˆ†åˆ«ä¸ºVariance Exploding(VE)SDEå’ŒVariance Preserving(VP) SDEã€‚</p><h4 id="ve-sde">VE-SDE</h4><p>å¯¹äºNCSNï¼Œæ‰©æ•£å…¬å¼ä¸ºï¼š <span class="math display">\[x_T=x_0+\sigma_T\varepsilon\]</span> ä¾é éå¸¸å¤§çš„ <span class="math inline">\(\sigma_T\)</span>ä½¿å¾— <span class="math inline">\(x_T\)</span> å˜ä¸ºä»¥ <spanclass="math inline">\(\epsilon\)</span> ä¸»å¯¼çš„é«˜æ–¯å™ªå£°ï¼Œå› æ­¤æ˜¯VarianceExplodingï¼ˆæ–¹å·®çˆ†ç‚¸ï¼‰ã€‚</p><p>NCSNæ¯ä¸€æ­¥çš„æ‰°åŠ¨æ ¸ <spanclass="math inline">\(p_{\sigma_i}(x|x_0)\)</span> çš„é©¬å°”ç§‘å¤«é“¾è¡¨ç¤ºï¼š<span class="math display">\[x_i=x_{i-1}+\sqrt{\sigma_i^2-\sigma_{i-1}^2}z_{i-1},i=1,...,N\]</span> è¿™é‡Œçš„ <span class="math inline">\(z_{i-1}\sim\mathcalN(0,I)\)</span> ,å½“ <span class="math inline">\(N\to\infty\)</span>æ—¶ï¼Œé©¬å°”ç§‘å¤«é“¾ <span class="math inline">\(\{x_i\}_{i=1}^N\)</span>å°±å˜æˆäº†è¿ç»­çš„éšæœºè¿‡ç¨‹ <spanclass="math inline">\(\{x(t)\}_{t=0}^1\)</span> ,<spanclass="math inline">\(\{\sigma_i\}_{i=1}^N\)</span> å˜ä¸ºå‡½æ•° <spanclass="math inline">\(\sigma(t)\)</span> , <spanclass="math inline">\(z_i\)</span> å˜ä¸º <spanclass="math inline">\(z(t)\)</span> , è¿™é‡Œçš„è¿ç»­æ—¶é—´å˜é‡ <spanclass="math inline">\(t\in [0,1]\)</span> , è€Œä¸æ˜¯æ•´æ•° <spanclass="math inline">\(i\in \{1,2,...,N\}\)</span>. ä»¤ <spanclass="math inline">\(x(\frac{i}{N})=x_i,\sigma(\frac{i}{N})=\sigma_i,z(\frac{i}{N})=z_i\)</span>, äºæ˜¯ <span class="math inline">\(\Deltat=\frac1N,t\in\{0,\frac1N,...,\frac{N-1}{N}\}\)</span> : <spanclass="math display">\[x(t+\Delta t)=x(t)+\sqrt{\sigma^2(t+\Delta t)-\sigma^2(t)}z(t)\\=x(t+\sqrt{\frac{\sigma^2(t+\Delta t)^2-\sigma^2(t)}{\Deltat}}\sqrt{\Delta t}z(t)\\=x(t)+\sqrt{\frac{\Delta\sigma^2}{\Delta t}}\sqrt{\Delta t}z(t)\]</span> äºæ˜¯å½“ <span class="math inline">\(\Delta t\to0\)</span> æ—¶ï¼š<span class="math display">\[f(x,t)=0,g(t)=\sqrt{\frac{d(\sigma_t^2)}{dt}}\]</span> äºæ˜¯VE-SDEä¸ºï¼š <span class="math display">\[dx=\sqrt{\frac{d(\sigma_t^2)}{dt}}d\omega\]</span></p><h4 id="vp-sde">VP-SDE</h4><p>å¯¹äºDDPMï¼Œæ‰©æ•£å…¬å¼ä¸ºï¼š <span class="math display">\[x_T=\sqrt{\bar\alpha_T}x_0+\sqrt{1-\bar\alpha_T}\varepsilon\]</span> ä¾é éå¸¸å°çš„ <spanclass="math inline">\(\sqrt{\bar\alpha_T}\)</span> å»å‹åˆ¶ <spanclass="math inline">\(x_0\)</span> ï¼Œè€Œæœ¬èº«æ–¹å·® <spanclass="math inline">\(\sqrt{1-\bar\alpha_T}\)</span>å¹¶ä¸å¤§ï¼Œå› æ­¤æ˜¯Variance Preservingï¼ˆæ–¹å·®ç¼©ç´§ï¼‰ã€‚</p><p>DDPMçš„æ‰°åŠ¨æ ¸ <spanclass="math inline">\(\{p_{\alpha_i}(x|x_0)\}_{i=1}^N\)</span> ,å®ƒçš„ç¦»æ•£åŒ–çš„é©¬å°”ç§‘å¤«é“¾è¡¨ç¤ºï¼š <span class="math display">\[x_i=\sqrt{1-\beta_i}x_{i-1}+\sqrt{\beta_i}z_{i-1},i=1,2,...,N\]</span> è¿™é‡Œ <span class="math inline">\(z_{i-1}\sim\mathcalN(0,I)\)</span> , ä¸ºäº†è·å¾—å½“ <span class="math inline">\(n\to\infty\)</span> æ—¶çš„é©¬å°”ç§‘å¤«é“¾çš„æé™ï¼Œå®šä¹‰ä¸€ä¸ªå™ªå£°çš„è¾…åŠ©é›†åˆ <spanclass="math inline">\(\{\bar\beta_i=N\beta_i\}_{i=1}^N\)</span> ,äºæ˜¯ï¼š<span class="math display">\[x_i=\sqrt{1-\frac{\bar\beta_i}{N}}x_{i-1}+\sqrt{\frac{\bar\beta_i}{N}}z_{i-1},i=1,2,...,N\]</span> å½“ <span class="math inline">\(N\to \infty\)</span>æ—¶ï¼ŒåŒä¸Šï¼Œå¾—ï¼š <span class="math display">\[x(t+\Delta t)=\sqrt{1-\beta(t+\Delta t)\Delta t}\x(t)+\sqrt{\beta(t+\Delta t)\Delta t}\ z(t)\\\approx (1-\frac12\beta(t+\Delta t)\Delta t)x(t)+\sqrt{\beta(t+\Deltat)\Delta t}\ z(t)\\\approx (1-\frac12\beta(t)\Delta t)x(t)+\sqrt{\beta(t)\Delta t}\ z(t)\]</span> äºæ˜¯å½“ <span class="math inline">\(\Delta t\to 0\)</span> æ—¶ï¼š<span class="math display">\[f(x,t)=-\frac12\beta(t)x(t),g(t)=\sqrt{\beta(t)}\]</span> äºæ˜¯VP-SDEä¸ºï¼š <span class="math display">\[dx=-\frac12\beta(t)xdt+\sqrt{\beta(t)}d\omega\]</span></p>]]></content>
    
    
    
    <tags>
      
      <tag>Diffusion</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
